<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BD TM MINI BOT</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Monetag SDK: 15s real popup -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .glass{background:rgba(255,255,255,.06);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.45)}
    .lighting{animation:glowColors 8s infinite alternate ease-in-out}
    @keyframes glowColors{
      0%{color:#34d399;text-shadow:0 0 12px #34d399}
      25%{color:#60a5fa;text-shadow:0 0 14px #60a5fa}
      50%{color:#a78bfa;text-shadow:0 0 16px #a78bfa}
      75%{color:#f59e0b;text-shadow:0 0 18px #f59e0b}
      100%{color:#fb7185;text-shadow:0 0 20px #fb7185}
    }
    .tab{display:none;opacity:0;transform:translateY(10px);transition:all .3s}
    .tab.show{display:block;opacity:1;transform:translateY(0)}
    .nav-btn{width:100%;display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 6px;border-radius:12px;font-weight:700;transition:.18s}
    .nav-btn.active{box-shadow:0 8px 24px rgba(124,58,237,.25);transform:translateY(-3px)}
    .bomb{position:fixed;left:50%;top:46%;transform:translate(-50%,-50%);font-size:3rem;z-index:60;animation:bombAnim .9s ease-out forwards;filter:drop-shadow(0 0 12px rgba(255,140,0,.9))}
    @keyframes bombAnim{0%{opacity:1;transform:translate(-50%,-50%) scale(.8)}60%{opacity:1;transform:translate(-50%,-62%) scale(1.6)}100%{opacity:0;transform:translate(-50%,-90%) scale(3)}}
    #toast{position:fixed;right:14px;bottom:92px;z-index:70;display:none;background:linear-gradient(90deg,#10b981,#06b6d4);color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.4)}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;font-size:13px}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#071024] via-[#0b1226] to-[#2b0b3a] text-white">

  <!-- Header -->
  <header class="w-full p-5 text-center">
    <div class="max-w-xl mx-auto glass p-4">
      <h1 class="text-3xl font-extrabold lighting">ЁЯТО BD TM MINI BOT</h1>
      <p class="opacity-80 text-sm">ржПржб ржжрзЗржЦрзЗ ржЖрзЯ ржХрж░рзБржи тАв рж░рзЗржлрж╛рж░ ржХрж░рзЗ ржмрзЛржирж╛рж╕ ржкрж╛ржи</p>
    </div>
  </header>

  <!-- Login + Join Gate -->
  <section class="max-w-xl mx-auto px-4">
    <div id="gate-card" class="glass p-4">
      <h2 class="font-bold mb-2 lighting">рж▓ржЧржЗржи ржХрж░рзБржи (Telegram)</h2>
      <!-- Replace data-telegram-login with your bot username; using your link name -->
      <div id="tg-login" class="my-2">
        <script async src="https://telegram.org/js/telegram-widget.js?22"
                data-telegram-login="BD_TM_MINI_BOT"
                data-size="large"
                data-userpic="false"
                data-onauth="onTelegramAuth(user)"
                data-request-access="write"></script>
      </div>

      <div class="mt-4">
        <a id="joinBtn" href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank"
           class="inline-block px-4 py-2 bg-green-600 rounded-xl font-semibold">ЁЯУв ржЖржорж╛ржжрзЗрж░ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржпрзЛржЧ ржжрж┐ржи</a>
      </div>
      <p class="text-xs opacity-80 mt-2">ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржпрзЛржЧ ржирж╛ ржжрж┐рж▓рзЗ ржПржмржВ рж▓ржЧржЗржи ржирж╛ ржХрж░рж▓рзЗ ржмржЯ ржХрж╛ржЬ ржХрж░ржмрзЗ ржирж╛ред</p>
    </div>
  </section>

  <!-- Main -->
  <main id="app" class="px-4 pb-32 max-w-xl mx-auto hidden">

    <!-- Home -->
    <section id="tab-home" class="tab show">
      <div class="glass p-5 mt-4 text-center">
        <div class="lighting">ржмрж░рзНрждржорж╛ржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕</div>
        <div class="text-4xl font-extrabold mt-1 lighting"><span id="ui-balance">0.00</span> рз│</div>
        <div class="mt-1 text-sm opacity-80">ржЖржЬржХрзЗрж░ ржПржб: <span id="ui-ads-count">0</span> / 100</div>

        <div class="mt-4 flex flex-col gap-3">
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank"
             class="px-4 py-2 bg-green-500 rounded-2xl font-semibold">ЁЯУв ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржЪрзНржпрж╛ржирзЗрж▓</a>
          <button onclick="openTab('ads')" class="px-4 py-2 bg-cyan-500 rounded-2xl font-semibold">тЦ╢ ржПржб ржжрзЗржЦрзБржи</button>
        </div>
      </div>
    </section>

    <!-- Ads -->
    <section id="tab-ads" class="tab">
      <div class="glass p-5 mt-4 text-center">
        <div class="lighting font-semibold">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</div>
        <div class="text-xs opacity-80 mt-1">Monetag ржкржкржЖржк ~ рззрзлрж╕рзЗржХ ржЪрж▓ржмрзЗ тАв рж░рж┐ржУрзЯрж╛рж░рзНржб рззрзнрж╕рзЗржХ ржкрж░ ржЕржЯрзЛ ржпрзЛржЧ</div>

        <button id="btn-watch" onclick="startAdFlow()" class="w-full py-3 mt-5 bg-blue-600 rounded-xl font-semibold">
          тЦ╢ ржПржЦржиржЗ рж╢рзБрж░рзБ ржХрж░рзБржи
        </button>
        <div id="ad-countdown" class="mt-3 text-sm opacity-90"></div>
      </div>
    </section>

    <!-- Withdraw -->
    <section id="tab-withdraw" class="tab">
      <div class="glass p-5 mt-4">
        <div class="font-semibold mb-2 lighting">ЁЯТ│ ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи</div>
        <div class="text-xs opacity-75 mb-3">ржорж┐ржирж┐ржорж╛ржо: ржмрж┐ржХрж╛рж╢ рззрзжрз│ тАв ржиржЧржж рзлрзжрз│ тАв рж░рж┐ржЪрж╛рж░рзНржЬ рзирзжрз│</div>

        <select id="wd-method" class="w-full p-3 rounded text-black">
          <option value="bkash">ржмрж┐ржХрж╛рж╢</option>
          <option value="nagad">ржиржЧржж</option>
          <option value="recharge">ржорзЛржмрж╛ржЗрж▓ рж░рж┐ржЪрж╛рж░рзНржЬ</option>
        </select>
        <input id="wd-number" class="w-full p-3 rounded mt-3 text-black" placeholder="ржиржорзНржмрж░ рж▓рж┐ржЦрзБржи"/>
        <input id="wd-amount" type="number" class="w-full p-3 rounded mt-3 text-black" placeholder="ржЯрж╛ржХрж╛рж░ ржкрж░рж┐ржорж╛ржг"/>

        <button onclick="submitWithdraw()" class="w-full py-3 mt-4 bg-emerald-600 rounded-xl font-semibold">рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи</button>
      </div>
    </section>

    <!-- History -->
    <section id="tab-history" class="tab">
      <div class="glass p-5 mt-4">
        <div class="font-semibold lighting">ЁЯУЬ ржЙржЗржержбрзНрж░ ржЗрждрж┐рж╣рж╛рж╕</div>
        <ul id="history-list" class="mt-3 space-y-3 text-sm"></ul>
      </div>
    </section>

    <!-- Refer -->
    <section id="tab-refer" class="tab">
      <div class="glass p-5 mt-4 text-center">
        <div class="font-semibold lighting">ЁЯОБ рж░рзЗржлрж╛рж░ ржХрж░рзЗ ржЖрзЯ</div>
        <div class="mt-3 text-sm opacity-80">ржЖржкржирж╛рж░ рж░рзЗржлрж╛рж░ рж▓рж┐ржВржХ ржмржирзНржзрзБржжрзЗрж░ ржжрж┐ржи</div>
        <div class="mt-4 flex gap-2 justify-center">
          <input id="ref-link" class="p-2 rounded text-black w-2/3" readonly value="https://t.me/BD_TM_MINI_BOT"/>
          <button onclick="copyRefer()" class="px-3 py-2 bg-pink-600 rounded-lg">ржХржкрж┐</button>
        </div>
      </div>
    </section>

    <!-- Admin -->
    <section id="tab-admin" class="tab">
      <div class="glass p-5 mt-4">
        <div class="lighting font-semibold">тЪЩя╕П ржПржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓</div>

        <div id="admin-login" class="mt-3">
          <input id="admin-pass" type="password" placeholder="ржЕрзНржпрж╛ржбржорж┐ржи ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржжрж┐ржи" class="w-full p-3 rounded text-black"/>
          <button onclick="adminLogin()" class="w-full py-2 mt-2 bg-yellow-500 rounded-lg font-semibold">рж▓ржЧржЗржи</button>
        </div>

        <div id="admin-area" class="hidden mt-4">
          <div class="font-semibold mb-2">рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк</div>
          <div class="text-sm opacity-80">ржорзЛржЯ ржЗржЙржЬрж╛рж░: <span id="admin-user-count">0</span> тАв ржорзЛржЯ ржПржб: <span id="admin-total-ads">0</span></div>
          <div class="text-sm opacity-80 mb-3">ржорзЛржЯ ржмрзНржпрж╛рж▓рзЗржирзНрж╕: <span id="admin-total-balance">0.00</span> рз│</div>

          <div class="font-semibold mt-2">ржЗржЙржЬрж╛рж░ рждрж╛рж▓рж┐ржХрж╛</div>
          <table class="table mt-1">
            <thead><tr><th>ID</th><th>Username</th><th>ржмрзНржпрж╛рж▓рзЗржирзНрж╕</th><th>ржЖржЬржХрзЗрж░ ржПржб</th></tr></thead>
            <tbody id="admin-users-tbody"></tbody>
          </table>

          <div class="font-semibold mt-4">ржкрзЗржирзНржбрж┐ржВ ржЙржЗржержбрзНрж░</div>
          <table class="table mt-1">
            <thead><tr><th>ID</th><th>User</th><th>ржкржжрзНржзрждрж┐</th><th>ржкрж░рж┐ржорж╛ржг</th><th>ржиржорзНржмрж░</th><th>ржЕрзНржпрж╛ржХрж╢ржи</th></tr></thead>
            <tbody id="admin-wd-tbody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-4 left-4 right-4 bg-black/30 rounded-2xl p-2 flex justify-between gap-2">
    <button id="nav-home" class="nav-btn active" onclick="openTab('home')">ЁЯПа<span class="text-xs">рж╣рзЛржо</span></button>
    <button id="nav-ads" class="nav-btn" onclick="openTab('ads')">тЦ╢<span class="text-xs">ржПржб</span></button>
    <button id="nav-withdraw" class="nav-btn" onclick="openTab('withdraw')">ЁЯТ│<span class="text-xs">ржЙржЗржержбрзНрж░</span></button>
    <button id="nav-history" class="nav-btn" onclick="openTab('history')">ЁЯУЬ<span class="text-xs">рж╣рж┐рж╕рзНржЯрзНрж░рж┐</span></button>
    <button id="nav-refer" class="nav-btn" onclick="openTab('refer')">ЁЯОБ<span class="text-xs">рж░рзЗржлрж╛рж░</span></button>
    <button id="nav-admin" class="nav-btn" onclick="openTab('admin')">тЪЩя╕П<span class="text-xs">ржПржбржорж┐ржи</span></button>
  </nav>

  <!-- Toast + Bomb -->
  <div id="toast"></div>
  <div id="bomb-root"></div>

<script>
/* ====== CONFIG (ржЖржкржирж╛рж░ ржжрзЗржУрзЯрж╛) ====== */
const BOT_TOKEN     = "8169503775:AAHFBx2dXbnXLZHje8MUzgsx5chWjxD9dKY";
const ADMIN_CHAT_ID = "7691157254";
const ADMIN_PASSWORD = "Sharif000";
const CHANNEL_ID_OR_USERNAME = "@ADS_EARNING_BD_TM_CHANNEL"; // Join check
const DAILY_LIMIT   = 100;
const REWARD_PER_AD = 0.20;
const MONETAG_SECONDS = 15; // info only
const REWARD_AFTER   = 17;  // ржЯрж╛ржХрж╛ ржЕрзНржпрж╛ржб

/* ====== STATE (localStorage) ====== */
const STORE_KEY = "bdtm_premium_state_v3";
let state = {
  users: {},            // tgId -> {id, username, balance, adsToday, lastDay}
  currentUserId: null,
  withdraws: []         // {id,userId,username,method,number,amount,status,ts}
};

function loadState(){
  const raw = localStorage.getItem(STORE_KEY);
  if(raw){ try{ state = JSON.parse(raw) }catch(e){} }
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
function currentUser(){ return state.users[state.currentUserId] || null; }
function todayKey(){ return new Date().toISOString().slice(0,10); }

/* ====== UI Helpers ====== */
function openTab(key){
  document.querySelectorAll('.tab').forEach(s=>{s.classList.remove('show')});
  const t = document.getElementById('tab-'+key);
  if(t) t.classList.add('show');
  ['home','ads','withdraw','history','refer','admin'].forEach(k=>{
    const b=document.getElementById('nav-'+k); if(b) b.classList.remove('active');
  });
  const nb=document.getElementById('nav-'+key); if(nb) nb.classList.add('active');
  if(key==='history') renderHistory();
  if(key==='admin') renderAdmin();
  if(key==='home') renderHome();
}
function showToast(text,ms=2600){
  const t=document.getElementById('toast');
  t.textContent=text; t.style.display='block'; t.style.opacity='1';
  setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=>t.style.display='none',400); }, ms);
}
function bomb(){
  const r=document.getElementById('bomb-root');
  const el=document.createElement('div'); el.className='bomb'; el.textContent='ЁЯТгЁЯТе';
  r.appendChild(el); setTimeout(()=>el.remove(),900);
}
function fmt(n){ try{return n.toLocaleString('bn-BD',{minimumFractionDigits:2,maximumFractionDigits:2})}catch(_){return (+n).toFixed(2)} }

/* ====== Telegram Login ====== */
async function onTelegramAuth(user){
  // user = {id, username, first_name, last_name, photo_url, auth_date, hash}
  loadState();
  const id = String(user.id);
  const username = user.username ? '@'+user.username : (user.first_name || 'User') ;
  if(!state.users[id]){
    state.users[id] = { id, username, balance:0, adsToday:0, lastDay: todayKey() };
  }
  state.currentUserId = id;
  saveState();
  await enforceJoinGate(); // check channel join
  enterApp();
}
function enterApp(){
  document.getElementById('gate-card').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  renderHome();
}

/* ====== Channel Join Check ====== */
async function enforceJoinGate(){
  const u = currentUser();
  if(!u){ return; }
  try{
    const url = `https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${encodeURIComponent(CHANNEL_ID_OR_USERNAME)}&user_id=${u.id}`;
    const res = await fetch(url);
    const data = await res.json();
    const okStatuses = ['member','administrator','creator','owner'];
    const status = data?.result?.status || 'left';
    if(!okStatuses.includes(status)){
      // keep app hidden
      document.getElementById('app').classList.add('hidden');
      document.getElementById('gate-card').classList.remove('hidden');
      showToast('ЁЯУв ржЖржЧрзЗ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рзБржи, рждрж╛рж░ржкрж░ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред');
      return false;
    }
    return true;
  }catch(e){
    // if API blocked, allow but warn
    showToast('тЪая╕П Join ржЪрзЗржХ ржХрж░рж╛ ржЧрзЗрж▓ ржирж╛, ржирзЗржЯржУрзЯрж╛рж░рзНржХ рж╕ржорж╕рзНржпрж╛ред');
    return true;
  }
}

/* ====== Daily Reset ====== */
function dailyResetIfNeeded(){
  const u=currentUser(); if(!u) return;
  const tk=todayKey();
  if(u.lastDay!==tk){ u.lastDay=tk; u.adsToday=0; saveState(); }
}

/* ====== Home Render ====== */
function renderHome(){
  dailyResetIfNeeded();
  const u=currentUser(); if(!u) return;
  document.getElementById('ui-balance').textContent = fmt(u.balance);
  document.getElementById('ui-ads-count').textContent = u.adsToday||0;
}

/* ====== Ads Flow ====== */
let adRunning=false;
async function startAdFlow(){
  const joined = await enforceJoinGate(); if(!joined) return;
  const u=currentUser(); if(!u){ showToast('ЁЯФР ржЖржЧрзЗ рж▓ржЧржЗржи ржХрж░рзБржи'); return; }
  dailyResetIfNeeded();
  if((u.adsToday||0) >= DAILY_LIMIT){ showToast('ржЖржЬржХрзЗрж░ 100 ржПржб рж▓рж┐ржорж┐ржЯ рж╢рзЗрж╖'); return; }
  if(adRunning) return;
  adRunning=true;
  const btn=document.getElementById('btn-watch'); const cd=document.getElementById('ad-countdown');
  btn.disabled=true; btn.style.opacity='.7';

  // Trigger Monetag popup (15s typical)
  try{ if(typeof show_9842278==='function') show_9842278(); }catch(_){}

  let left = REWARD_AFTER; // 17 sec for reward
  cd.textContent = `тП│ ржмрж┐ржЬрзНржЮрж╛ржкржи ржЪрж▓ржЫрзЗ... ${left}s`;
  const t = setInterval(()=>{
    left--;
    if(left>0){ cd.textContent = `тП│ ржмрж┐ржЬрзНржЮрж╛ржкржи ржЪрж▓ржЫрзЗ... ${left}s`; return; }
    clearInterval(t);
    // Give reward
    u.balance = +(u.balance + REWARD_PER_AD).toFixed(2);
    u.adsToday = (u.adsToday||0)+1;
    saveState();
    renderHome();
    bomb();
    cd.textContent = `тЬЕ ржПржб рж╢рзЗрж╖! +${REWARD_PER_AD} рз│ ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ`;
    showToast(`тЬЕ ${REWARD_PER_AD} рз│ ржпрзЛржЧ рж╣рж▓рзЛ`);
    btn.disabled=false; btn.style.opacity='1';
    adRunning=false;
  },1000);
}

/* ====== Withdraw ====== */
async function submitWithdraw(){
  const joined = await enforceJoinGate(); if(!joined) return;
  const u=currentUser(); if(!u){ showToast('ЁЯФР ржЖржЧрзЗ рж▓ржЧржЗржи ржХрж░рзБржи'); return; }

  const method = document.getElementById('wd-method').value;
  const number = (document.getElementById('wd-number').value||'').trim();
  const amount = parseFloat(document.getElementById('wd-amount').value);

  let min=10; if(method==='nagad') min=50; if(method==='recharge') min=20;

  if(!number || isNaN(amount)){ alert('тЪая╕П рж╕ржарж┐ржХ ржиржорзНржмрж░ ржУ ржкрж░рж┐ржорж╛ржг ржжрж┐ржи'); return; }
  if(amount < min){ alert(`тЪая╕П ${method} ржПрж░ ржЬржирзНржп ржирзНржпрзВржирждржо ${min} рз│ ржжрж░ржХрж╛рж░`); return; }
  if(amount > u.balance){ alert('тЪая╕П ржкрж░рзНржпрж╛ржкрзНржд ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржирзЗржЗ'); return; }

  // deduct and create request
  u.balance = +(u.balance - amount).toFixed(2);
  const req = {
    id:'W'+Date.now().toString(36)+Math.floor(Math.random()*999),
    userId:u.id,
    username:u.username,
    method, number, amount,
    status:'Pending',
    ts:new Date().toISOString()
  };
  state.withdraws.push(req);
  saveState();
  renderHome();
  renderHistory();
  showToast('ЁЯУй ржЙржЗржержбрзНрж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛ рж╣рж▓рзЛ (Pending)');

  // Notify Admin + also ping user (if bot started)
  const text = `ЁЯУй ржирждрзБржи ржЙржЗржержбрзНрж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ\nID: ${req.id}\nЁЯСд User: ${u.username} (${u.id})\nЁЯТ│ Method: ${method}\nЁЯУ▒ Number: ${number}\nЁЯТ░ Amount: рз│${fmt(amount)}`;
  sendTelegram(ADMIN_CHAT_ID, text);
  sendTelegram(u.id, `тЬЕ ржЖржкржирж╛рж░ ржЙржЗржержбрзНрж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ рж░рж┐рж╕рж┐ржнржб: ${req.id}\nрж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕: Pending`);
}

/* ====== History Render ====== */
function renderHistory(){
  const ul=document.getElementById('history-list'); ul.innerHTML='';
  const mine = state.withdraws.filter(r=>r.userId===state.currentUserId).slice().reverse();
  if(mine.length===0){ ul.innerHTML='<li class="opacity-80 text-sm">ржХрзЛржирзЛ ржЗрждрж┐рж╣рж╛рж╕ ржирзЗржЗред</li>'; return; }
  mine.forEach(r=>{
    const li=document.createElement('li'); li.className='p-3 bg-white/5 rounded';
    li.innerHTML = `<div class="flex justify-between">
      <div><b>${r.id}</b><div class="text-xs opacity-80">${r.method} тЖТ ${r.number}</div></div>
      <div class="text-right"><div>рз│ ${fmt(r.amount)}</div><div class="text-xs ${r.status==='Pending'?'text-yellow-300':r.status==='Approved'?'text-emerald-300':'text-rose-300'}">${r.status}</div></div>
    </div>
    <div class="text-xs opacity-70 mt-1">${new Date(r.ts).toLocaleString()}</div>`;
    ul.appendChild(li);
  });
}

/* ====== Admin ====== */
function adminLogin(){
  const p=document.getElementById('admin-pass').value;
  if(p===ADMIN_PASSWORD){
    document.getElementById('admin-login').classList.add('hidden');
    document.getElementById('admin-area').classList.remove('hidden');
    renderAdmin();
  }else{
    alert('тЭМ ржнрзБрж▓ ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб');
  }
}
function renderAdmin(){
  const tbody=document.getElementById('admin-users-tbody');
  const wtbody=document.getElementById('admin-wd-tbody');
  if(!tbody||!wtbody) return;

  // Summary
  const users = Object.values(state.users);
  document.getElementById('admin-user-count').textContent = users.length;
  const totalAds = users.reduce((a,u)=>a+(u.adsToday||0),0);
  document.getElementById('admin-total-ads').textContent = totalAds;
  const totalBal = users.reduce((a,u)=>a+(u.balance||0),0);
  document.getElementById('admin-total-balance').textContent = fmt(totalBal);

  // Users table
  tbody.innerHTML='';
  users.forEach(u=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${u.id}</td><td>${u.username||'-'}</td><td>рз│ ${fmt(u.balance||0)}</td><td>${u.adsToday||0}</td>`;
    tbody.appendChild(tr);
  });

  // Pending withdraws
  wtbody.innerHTML='';
  state.withdraws.filter(r=>r.status==='Pending').slice().reverse().forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td>
      <td>${r.username} (${r.userId})</td>
      <td>${r.method}</td>
      <td>рз│ ${fmt(r.amount)}</td>
      <td>${r.number}</td>
      <td class="space-x-1">
        <button class="px-2 py-1 bg-emerald-600 rounded" onclick="adminApprove('${r.id}')">Approve</button>
        <button class="px-2 py-1 bg-rose-600 rounded" onclick="adminReject('${r.id}')">Reject</button>
      </td>`;
    wtbody.appendChild(tr);
  });
}
function adminApprove(id){
  const r = state.withdraws.find(x=>x.id===id); if(!r) return;
  r.status='Approved'; saveState(); renderHistory(); renderAdmin();
  sendTelegram(ADMIN_CHAT_ID, `тЬЕ APPROVED: ${r.id} тАв ${r.username} (${r.userId}) тАв рз│${fmt(r.amount)} тАв ${r.method}/${r.number}`);
  sendTelegram(r.userId, `тЬЕ ржЖржкржирж╛рж░ ржЙржЗржержбрзНрж░ APPROVED рж╣рзЯрзЗржЫрзЗ: ${r.id}`);
  showToast('тЬЕ Approved');
}
function adminReject(id){
  const r = state.withdraws.find(x=>x.id===id); if(!r) return;
  r.status='Rejected'; // ржЯрж╛ржХрж╛ ржлрзЗрж░ржд ржЪрж╛ржЗрж▓рзЗ ржПржЦрж╛ржирзЗ ржмрзНржпрж╛рж▓рзЗржирзНрж╕рзЗ ржпрзЛржЧ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи
  saveState(); renderHistory(); renderAdmin();
  sendTelegram(ADMIN_CHAT_ID, `тЭМ REJECTED: ${r.id} тАв ${r.username} (${r.userId}) тАв рз│${fmt(r.amount)} тАв ${r.method}/${r.number}`);
  sendTelegram(r.userId, `тЭМ ржЖржкржирж╛рж░ ржЙржЗржержбрзНрж░ REJECTED рж╣рзЯрзЗржЫрзЗ: ${r.id}`);
  showToast('тЭМ Rejected');
}

/* ====== Telegram Send ====== */
function sendTelegram(chatId, text){
  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chat_id: String(chatId), text})
  }).catch(()=>{});
}

/* ====== Refer ====== */
function copyRefer(){
  const link = document.getElementById('ref-link').value;
  navigator.clipboard.writeText(link).then(()=>showToast('тЬЕ рж░рзЗржлрж╛рж░ рж▓рж┐ржВржХ ржХржкрж┐ рж╣рзЯрзЗржЫрзЗ'));
}

/* ====== Boot ====== */
loadState();
// ржпржжрж┐ ржкрзВрж░рзНржмрзЗ рж▓ржЧржЗржи ржХрж░рж╛ ржерж╛ржХрзЗ (state.currentUserId), рждрж╛рж╣рж▓рзЗ ржЕрзНржпрж╛ржк ржжрзЗржЦрж╛ржЗ ржУ join ржЪрзЗржХ ржХрж░рж┐
(asyn