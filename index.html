<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BD TM MINI BOT</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Monetag SDK (ржЖржкржирж┐ ржЖржЧрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрж┐рж▓рзЗржи) -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>

  <style>
    body{font-family:system-ui,"Noto Sans Bengali",Arial;background:linear-gradient(180deg,#071024,#120924);color:#fff;margin:0;padding-bottom:110px}
    .container{max-width:520px;margin:0 auto;padding:16px}
    .glass{background:rgba(255,255,255,0.06);backdrop-filter:blur(8px);border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.04)}
    .lighting{animation:glowColors 6s infinite}
    @keyframes glowColors{0%{color:#34d399}25%{color:#60a5fa}50%{color:#a78bfa}75%{color:#fb7185}100%{color:#f59e0b}}
    .toast{position:fixed;right:16px;bottom:120px;padding:10px 14px;border-radius:10px;color:#fff;display:none;z-index:9999}
    .bomb{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);font-size:3rem;z-index:9998;animation:bombAnim .9s forwards}
    @keyframes bombAnim{0%{opacity:1;transform:translate(-50%,-50%) scale(.6)}60%{transform:translate(-50%,-60%) scale(1.6)}100%{opacity:0;transform:translate(-50%,-120%) scale(2.6)}}
    .bottom-nav{position:fixed;left:12px;right:12px;bottom:12px;display:flex;gap:8px;background:rgba(0,0,0,0.26);padding:8px;border-radius:14px;backdrop-filter:blur(6px);z-index:60}
    .nav-btn{flex:1;text-align:center;padding:10px 6px;border-radius:12px;cursor:pointer;user-select:none}
    .nav-btn .icon{font-size:18px;display:block}
    .nav-btn.active{box-shadow:0 10px 30px rgba(124,58,237,0.18);transform:translateY(-4px)}
    .tab{display:none}
    .tab.show{display:block;animation:fade .25s}
    @keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    table{width:100%;border-collapse:collapse}
    table th,table td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.04);font-size:13px;text-align:left}
    input,select{outline:none}
  </style>
</head>
<body>
  <div class="container">

    <!-- Header -->
    <header class="glass text-center mb-4">
      <h1 class="text-2xl font-bold lighting">BD TM MINI BOT</h1>
      <p class="text-sm mt-1">ржПржб ржжрзЗржЦрзБржи, ржЖрзЯ ржХрж░рзБржи тАФ ржкрзНрж░рждрж┐ржжрж┐ржи рж╕рж░рзНржмрзЛржЪрзНржЪ рззрзжрзж ржПржб</p>
    </header>

    <!-- JOIN (default until joined) -->
    <section id="tab-join" class="tab show glass mb-4">
      <h3 class="font-bold">ЁЯУв ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рзБржи</h3>
      <p class="text-sm mt-2">ржмржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржЬржирзНржп ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рж╛ ржЖржмрж╢рзНржпржХ</p>
      <a id="joinLink" href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank" class="block mt-4 px-4 py-3 bg-green-500 rounded-lg text-center font-semibold">тЬЕ ржЪрзНржпрж╛ржирзЗрж▓ ржЬрзЯрзЗржи ржХрж░рзБржи</a>
      <button id="confirmJoinBtn" class="block mt-3 px-4 py-3 bg-yellow-500 rounded-lg w-full font-semibold">ржЖржорж┐ ржЬрзЯрзЗржи ржХрж░рзЗржЫрж┐</button>
      <p class="text-xs mt-2 text-gray-300">ржирзЛржЯ: рж╕ржарж┐ржХржнрж╛ржмрзЗ ржЬрзЯрзЗржи ржХрж░рзЗ тАЬржЖржорж┐ ржЬрзЯрзЗржи ржХрж░рзЗржЫрж┐тАЭ ржЪрж╛ржкрзБржи</p>
    </section>

    <!-- HOME -->
    <section id="tab-home" class="tab glass mb-4">
      <div class="text-center">
        <div class="text-sm lighting">ржмрж░рзНрждржорж╛ржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕</div>
        <div id="ui-balance" class="text-3xl font-bold mt-2 lighting">0.00 рз│</div>
        <div class="mt-2 text-sm">ржЖржЬ ржжрзЗржЦрж╛ ржПржб: <span id="ui-ads-count">0</span> / 100</div>
      </div>
      <div class="mt-4 flex gap-2">
        <button id="goAdsBtn" class="w-1/2 px-3 py-2 bg-cyan-500 rounded-xl">тЦ╢ ржПржб ржжрзЗржЦрзБржи</button>
        <button id="goWithdrawBtn" class="w-1/2 px-3 py-2 bg-emerald-600 rounded-xl">ЁЯТ│ ржЙржЗржержбрзНрж░</button>
      </div>
    </section>

    <!-- ADS -->
    <section id="tab-ads" class="tab glass mb-4">
      <div class="flex items-center justify-between">
        <div class="font-semibold lighting">ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрзБржи</div>
        <div class="text-xs">Monetag рззрзлs тАв ржкрзЯрзЗржирзНржЯ рззрзнs ржкрж░рзЗ</div>
      </div>
      <div class="mt-6">
        <button id="btn-watch" class="w-full py-3 bg-blue-600 rounded-xl lighting">тЦ╢ ржПржЦржиржЗ ржжрзЗржЦрзБржи <div class="text-xs mt-1">ржмрж╛ржХрж┐ ржПржб: <span id="ads-left">100</span></div></button>
      </div>
      <div id="ad-countdown" class="mt-4 text-sm"></div>
    </section>

    <!-- WITHDRAW -->
    <section id="tab-withdraw" class="tab glass mb-4">
      <div class="font-semibold">ЁЯТ│ ржЙржЗржержбрзНрж░</div>
      <div class="text-xs mt-1">ржмрж┐ржХрж╛рж╢: ржирзНржпрзВржирждржо рззрзжрз│ тАв ржиржЧржж: ржирзНржпрзВржирждржо рзлрзжрз│ тАв рж░рж┐ржЪрж╛рж░рзНржЬ: ржирзНржпрзВржирждржо рзирзжрз│</div>

      <div class="mt-3">
        <select id="withdraw-method" class="w-full p-2 rounded text-black">
          <option value="bkash">ржмрж┐ржХрж╛рж╢</option><option value="nagad">ржиржЧржж</option><option value="recharge">ржорзЛржмрж╛ржЗрж▓ рж░рж┐ржЪрж╛рж░рзНржЬ</option>
        </select>
        <input id="withdraw-number" class="w-full p-2 mt-2 rounded" placeholder="ржиржорзНржмрж░ рж▓рж┐ржЦрзБржи (01XXXXXXXXX)" />
        <input id="withdraw-amount" type="number" class="w-full p-2 mt-2 rounded" placeholder="ржЯрж╛ржХрж╛рж░ ржкрж░рж┐ржорж╛ржг" />
        <button id="submit-withdraw" class="w-full mt-3 py-2 bg-emerald-600 rounded-lg">рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи</button>
        <p class="text-xs mt-2 text-gray-300">рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛рж▓рзЗ ржЕрзНржпрж╛ржбржорж┐ржиржХрзЗ ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржорзЗ ржорзЗрж╕рзЗржЬ ржпрж╛ржмрзЗ ржПржмржВ ржПржЦрж╛ржирзЗ Pending рж╣рж┐рж╕рзЗржмрзЗ ржжрзЗржЦрж╛ржмрзЗ</p>
      </div>
    </section>

    <!-- ACCOUNT -->
    <section id="tab-account" class="tab glass mb-4">
      <div class="font-semibold">ЁЯСд ржЖржорж╛рж░ ржПржХрж╛ржЙржирзНржЯ</div>
      <div class="mt-2 text-sm">ржЗржЙржЬрж╛рж░ ржЖржЗржбрж┐: <span id="acc-id"></span></div>
      <div class="mt-1 text-sm">ржмрзНржпрж╛рж▓рзЗржирзНрж╕: <span id="acc-balance"></span> рз│</div>
      <div class="mt-1 text-sm">ржЖржЬржХрзЗрж░ ржПржб: <span id="acc-ads-today"></span></div>
      <div class="mt-1 text-sm">ржорзЛржЯ ржПржб: <span id="acc-ads-total"></span></div>
      <div class="mt-3">
        <input id="refer-link" class="w-full p-2 rounded text-black" readonly value="https://t.me/BD_TM_MINI_BOT" />
        <button id="copy-refer" class="w-full mt-2 py-2 bg-pink-600 rounded-lg">рж░рзЗржлрж╛рж░ рж▓рж┐ржВржХ ржХржкрж┐ ржХрж░рзБржи</button>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="tab-admin" class="tab glass mb-4">
      <div class="font-semibold lighting">тЪЩя╕П ржЕрзНржпрж╛ржбржорж┐ржи ржкрзНржпрж╛ржирзЗрж▓</div>
      <div id="admin-login-area" class="mt-3">
        <input id="admin-pass" type="password" class="w-full p-2 rounded text-black" placeholder="ржПржЦрж╛ржирзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржжрж┐ржи" />
        <button id="admin-login-btn" class="w-full mt-2 py-2 bg-yellow-500 rounded-lg">рж▓ржЧржЗржи</button>
      </div>

      <div id="admin-area" class="hidden mt-4">
        <div class="mb-3">
          <div>ЁЯСе ржорзЛржЯ ржЗржЙржЬрж╛рж░: <span id="admin-user-count">0</span></div>
          <div>тЦ╢ ржорзЛржЯ ржПржб ржжрзЗржЦрж╛: <span id="admin-total-ads">0</span></div>
          <div>ЁЯТ░ рж╕ржм ржмрзНржпрж╛рж▓рзЗржирзНрж╕: <span id="admin-total-balance">0.00</span> рз│</div>
        </div>

        <div class="mt-2">
          <div class="font-semibold">ЁЯУЛ ржЗржЙржЬрж╛рж░ рждрж╛рж▓рж┐ржХрж╛</div>
          <table class="mt-2"><thead><tr><th>ID</th><th>ржмрзНржпрж╛рж▓рзЗржирзНрж╕</th><th>ржЖржЬ</th><th>ржорзЛржЯ</th></tr></thead><tbody id="admin-users-tbody"></tbody></table>
        </div>

        <div class="mt-4">
          <div class="font-semibold">ЁЯТ│ Pending Withdraw</div>
          <table class="mt-2"><thead><tr><th>ID</th><th>User</th><th>ржкржжрзНржзрждрж┐</th><th>ржиржорзНржмрж░</th><th>ржЯрж╛ржХрж╛</th><th>Action</th></tr></thead><tbody id="admin-withdraws-tbody"></tbody></table>
        </div>
      </div>
    </section>

  </div> <!-- container end -->

  <!-- bottom nav -->
  <div class="bottom-nav">
    <div id="nav-home" class="nav-btn active" onclick="navOpen('home')"><span class="icon">ЁЯПа</span><div style="font-size:12px">рж╣рзЛржо</div></div>
    <div id="nav-ads" class="nav-btn" onclick="navOpen('ads')"><span class="icon">тЦ╢</span><div style="font-size:12px">ржПржб</div></div>
    <div id="nav-withdraw" class="nav-btn" onclick="navOpen('withdraw')"><span class="icon">ЁЯТ│</span><div style="font-size:12px">ржЙржЗржержбрзНрж░</div></div>
    <div id="nav-account" class="nav-btn" onclick="navOpen('account')"><span class="icon">ЁЯСд</span><div style="font-size:12px">ржПржХрж╛ржЙржирзНржЯ</div></div>
    <div id="nav-admin" class="nav-btn" onclick="navOpen('admin')"><span class="icon">тЪЩя╕П</span><div style="font-size:12px">ржПржбржорж┐ржи</div></div>
  </div>

  <!-- toast + bomb roots -->
  <div id="toast-root" class="toast"></div>
  <div id="bomb-root"></div>

<script>
/* ========== CONFIG ========== */
const BOT_TOKEN = "8169503775:AAHFBx2dXbnXLZHje8MUzgsx5chWjxD9dKY";
const ADMIN_CHAT_ID = "7691157254";
const ADMIN_PASSWORD = "Sharif000";

const DAILY_LIMIT = 100;
const AD_REWARD = 0.20;
const MONETAG_SECONDS = 15; // Monetag ad length (info)
const REWARD_SECONDS = 17;  // reward delivered after 17s

const STORAGE_KEY = "bdtm_state_final_v1";

/* ========== STATE ========== */
let state = {
  users: {},        // id -> {id,balance,adsToday,adsTotal,lastAdDate}
  withdraws: [],    // {id,userId,method,number,amount,status,ts}
  currentUserId: null
};

/* ========== HELPERS ========== */
function uid(){ return 'u'+Date.now().toString(36)+Math.floor(Math.random()*9000+1000).toString(36); }
function todayKey(){ return new Date().toISOString().slice(0,10); }

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){ try{ state = JSON.parse(raw); } catch(e){ console.warn('state parse err', e); } }
  if(!state.currentUserId){
    const id = uid();
    state.currentUserId = id;
    state.users[id] = { id, balance:0, adsToday:0, adsTotal:0, lastAdDate: todayKey() };
    saveState();
  }
  // ensure fields present
  Object.values(state.users).forEach(u=>{
    if(typeof u.balance === 'undefined') u.balance = 0;
    if(typeof u.adsToday === 'undefined') u.adsToday = 0;
    if(typeof u.adsTotal === 'undefined') u.adsTotal = 0;
    if(!u.lastAdDate) u.lastAdDate = todayKey();
  });
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function currentUser(){ return state.users[state.currentUserId]; }
function ensureDailyResetForUser(u){
  const tk = todayKey();
  if(u.lastAdDate !== tk){ u.adsToday = 0; u.lastAdDate = tk; }
}

/* ========== UI HELPERS ========== */
function showToast(msg, type='info', ms=3500){
  const root = document.getElementById('toast-root');
  root.innerText = msg;
  root.style.display = 'block';
  if(type==='success') root.style.background = 'linear-gradient(90deg,#10b981,#06b6d4)';
  else if(type==='error') root.style.background = 'linear-gradient(90deg,#ef4444,#f97316)';
  else root.style.background = 'linear-gradient(90deg,#2563eb,#06b6d4)';
  setTimeout(()=>{ root.style.display = 'none'; }, ms);
}
function showBomb(){ const r=document.getElementById('bomb-root'); const el=document.createElement('div'); el.className='bomb'; el.innerText='ЁЯТгЁЯТе'; r.appendChild(el); setTimeout(()=>el.remove(),900); }

/* ========== JOIN & NAV ========= */
let joined_channel = (localStorage.getItem('bdtm_joined') === 'yes');
function setJoined(val){ joined_channel = val; localStorage.setItem('bdtm_joined', val ? 'yes' : 'no'); }
function navOpen(key){
  if(!joined_channel && key !== 'join'){ showToast('тЪая╕П ржЖржЧрзЗ ржЕржлрж┐рж╕рж┐рзЯрж╛рж▓ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рзБржи', 'error'); openTab('join'); return; }
  openTab(key);
}
function openTab(key){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('show'));
  const map = {home:'tab-home', ads:'tab-ads', withdraw:'tab-withdraw', account:'tab-account', admin:'tab-admin', join:'tab-join'};
  const id = map[key];
  if(!id) return;
  document.getElementById(id).classList.add('show');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  const navMap = {home:'nav-home', ads:'nav-ads', withdraw:'nav-withdraw', account:'nav-account', admin:'nav-admin'};
  if(navMap[key]) document.getElementById(navMap[key]).classList.add('active');
  // render dynamic parts
  renderHome();
  if(key==='account') renderAccount();
  if(key==='admin') renderAdmin();
}

/* ========== INIT ========== */
loadState();
ensureDailyResetForUser(currentUser());
saveState();

/* ========== RENDER FUNCTIONS ========== */
function renderHome(){
  const u = currentUser(); ensureDailyResetForUser(u);
  document.getElementById('ui-balance').innerText = (u.balance||0).toFixed(2) + ' рз│';
  document.getElementById('ui-ads-count').innerText = (u.adsToday||0);
  document.getElementById('ads-left').innerText = Math.max(0, DAILY_LIMIT - (u.adsToday||0));
}
function renderAccount(){
  const u = currentUser(); ensureDailyResetForUser(u);
  document.getElementById('acc-id').innerText = u.id;
  document.getElementById('acc-balance').innerText = (u.balance||0).toFixed(2);
  document.getElementById('acc-ads-today').innerText = u.adsToday||0;
  document.getElementById('acc-ads-total').innerText = u.adsTotal||0;
}
function renderAdmin(){
  // users
  const tbody = document.getElementById('admin-users-tbody'); tbody.innerHTML = '';
  let totalUsers = 0, totalAds = 0, totalBalance = 0;
  Object.values(state.users).forEach(u=>{
    ensureDailyResetForUser(u);
    totalUsers++;
    totalAds += (u.adsTotal||0);
    totalBalance += Number(u.balance||0);
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.id}</td><td>${(u.balance||0).toFixed(2)} рз│</td><td>${u.adsToday||0}</td><td>${u.adsTotal||0}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('admin-user-count').innerText = totalUsers;
  document.getElementById('admin-total-ads').innerText = totalAds;
  document.getElementById('admin-total-balance').innerText = totalBalance.toFixed(2);
  // withdraws
  const wt = document.getElementById('admin-withdraws-tbody'); wt.innerHTML = '';
  state.withdraws.filter(w=>w.status==='Pending').forEach(w=>{
    const row = document.createElement('tr');
    row.innerHTML = `<td>${w.id}</td><td>${w.userId}</td><td>${w.method}</td><td>${w.number}</td><td>рз│ ${w.amount}</td>
      <td><button onclick="adminApprove('${w.id}')" style="background:#10b981;color:#fff;padding:6px;border-radius:6px">Approve</button>
      <button onclick="adminReject('${w.id}')" style="background:#ef4444;color:#fff;padding:6px;border-radius:6px;margin-left:6px">Reject</button></td>`;
    wt.appendChild(row);
  });
}

/* ========== AD FLOW ========== */
let adRunning = false;
function adsRemainingForUser(){ const u=currentUser(); ensureDailyResetForUser(u); return Math.max(0, DAILY_LIMIT - (u.adsToday||0)); }

document.getElementById('btn-watch').addEventListener('click', startAdFlow);
document.getElementById('goAdsBtn').addEventListener('click', ()=> navOpen('ads'));
document.getElementById('goWithdrawBtn').addEventListener('click', ()=> navOpen('withdraw'));

function startAdFlow(){
  const u = currentUser(); ensureDailyResetForUser(u);
  if(adRunning) return;
  if(adsRemainingForUser() <= 0){ showToast('тЪая╕П ржЖржЬржХрзЗрж░ 100 ржПржб рж╢рзЗрж╖ рж╣рзЯрзЗржЫрзЗ', 'error'); return; }

  // Monetag call (15s). If not present, we'll simulate a 15s dummy overlay.
  if(typeof show_9842278 === 'function'){
    try{ show_9842278(); } catch(e){ console.warn('Monetag error', e); }
  } else {
    // simulate a simple overlay so user sees something
    simulateAdOverlay();
  }

  adRunning = true;
  let left = REWARD_SECONDS;
  const cd = document.getElementById('ad-countdown');
  const btn = document.getElementById('btn-watch');
  btn.disabled = true; btn.style.opacity = '0.6';
  cd.innerText = `тП│ ${left} рж╕рзЗржХрзЗржирзНржб ржЪрж▓ржЫрзЗ...`;

  const t = setInterval(()=>{
    left--;
    if(left>0){ cd.innerText = `тП│ ${left} рж╕рзЗржХрзЗржирзНржб ржЪрж▓ржЫрзЗ...`; return; }
    clearInterval(t); adRunning = false; btn.disabled = false; btn.style.opacity = '1';
    // reward
    u.balance = +((u.balance||0) + AD_REWARD).toFixed(2);
    u.adsToday = (u.adsToday||0) + 1;
    u.adsTotal = (u.adsTotal||0) + 1;
    u.lastAdDate = todayKey();
    saveState();
    renderHome();
    showBomb();
    showToast(`тЬЕ +${AD_REWARD.toFixed(2)} рз│ ржпрзЛржЧ рж╣ржпрж╝рзЗржЫрзЗ!`, 'success');
    cd.innerText = 'тЬЕ ржмрж┐ржЬрзНржЮрж╛ржкржи рж╢рзЗрж╖!';
    // optional: notify admin (commented by default to avoid spam)
    // sendToAdmin(`ЁЯУв ржмрж┐ржЬрзНржЮрж╛ржкржи ржжрзЗржЦрж╛: User ${u.id} тАв ржЖржЬ: ${u.adsToday} тАв ржмрзНржпрж╛рж▓рзЗржирзНрж╕: ${u.balance.toFixed(2)} рз│`);
  }, 1000);
}

/* simulate overlay if Monetag SDK absent */
function simulateAdOverlay(){
  const overlay = document.createElement('div');
  overlay.style.position='fixed'; overlay.style.left='0'; overlay.style.top='0'; overlay.style.right='0'; overlay.style.bottom='0';
  overlay.style.background='rgba(0,0,0,0.85)'; overlay.style.zIndex='9997'; overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center';
  overlay.style.color='#fff'; overlay.style.fontSize='18px'; overlay.innerText = 'Monetag Ad (Simulated) тАФ 15s';
  document.body.appendChild(overlay);
  let s=15; const iv=setInterval(()=>{ s--; overlay.innerText = 'Monetag Ad (Simulated) тАФ '+s+'s'; if(s<=0){ clearInterval(iv); overlay.remove(); } },1000);
}

/* ========== WITHDRAW FLOW ========== */
document.getElementById('submit-withdraw').addEventListener('click', submitWithdraw);
const MIN = { bkash:10, nagad:50, recharge:20 };

function submitWithdraw(){
  if(!joined_channel){ showToast('тЪая╕П ржЖржЧрзЗ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рзБржи', 'error'); openTab('join'); return; }
  const method = document.getElementById('withdraw-method').value;
  const number = document.getElementById('withdraw-number').value.trim();
  const amount = parseFloat(document.getElementById('withdraw-amount').value);
  if(!number || isNaN(amount) || amount<=0){ showToast('тЪая╕П рж╕ржарж┐ржХ ржиржорзНржмрж░ ржУ ржкрж░рж┐ржорж╛ржг ржжрж┐ржи', 'error'); return; }
  const min = method === 'bkash' ? MIN.bkash : method === 'nagad' ? MIN.nagad : MIN.recharge;
  if(amount < min){ showToast(`тЪая╕П ржирзНржпрзВржирждржо ${min}рз│`, 'error'); return; }
  const u = currentUser();
  if(amount > (u.balance||0)){ showToast('тЪая╕П ржкрж░рзНржпрж╛ржкрзНржд ржмрзНржпрж╛рж▓рзЗржирзНрж╕ ржирзЗржЗ', 'error'); return; }

  // deduct now and create pending withdraw
  u.balance = +((u.balance||0) - amount).toFixed(2);
  const req = { id:'W'+Date.now().toString(36), userId:u.id, method, number, amount, status:'Pending', ts:new Date().toISOString() };
  state.withdraws.push(req);
  saveState();
  renderHome(); renderAdmin();
  showToast('ЁЯУд ржЖржкржирж╛рж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржЕрзНржпрж╛ржбржорж┐ржирзЗрж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗржЫрзЗ', 'info');

  // notify admin (may be blocked by CORS in some browsers)
  const adminMsg = `ЁЯТ│ ржирждрзБржи ржЙржЗржержбрзНрж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ\nID: ${req.id}\nUser: ${u.id}\nржкржжрзНржзрждрж┐: ${method}\nржкрж░рж┐ржорж╛ржг: рз│${amount}\nржиржорзНржмрж░: ${number}`;
  sendToAdmin(adminMsg);
}

/* ========== ADMIN ACTIONS ========== */
document.getElementById('admin-login-btn').addEventListener('click', adminLogin);

function adminLogin(){
  const p = document.getElementById('admin-pass').value;
  if(p !== ADMIN_PASSWORD){ showToast('тЭМ ржнрзБрж▓ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб', 'error'); return; }
  document.getElementById('admin-login-area').classList.add('hidden');
  document.getElementById('admin-area').classList.remove('hidden');
  renderAdmin();
  showToast('тЬЕ ржЕрзНржпрж╛ржбржорж┐ржи рж▓ржЧржЗржи рж╕ржлрж▓', 'success');
}

function adminApprove(wid){
  const w = state.withdraws.find(x=>x.id===wid); if(!w) return;
  w.status = 'Accepted'; saveState(); renderAdmin();
  sendToAdmin(`тЬЕ ржЙржЗржержбрзНрж░ ржЕржирзБржорзЛржжрж┐ржд\nID: ${w.id}\nUser: ${w.userId}\nрз│ ${w.amount}`);
  if(state.currentUserId === w.userId) showToast('тЬЕ ржЖржкржирж╛рж░ ржЙржЗржержбрзНрж░ ржЕржирзБржорзЛржжрж┐ржд рж╣рзЯрзЗржЫрзЗ', 'success');
}
function adminReject(wid){
  const w = state.withdraws.find(x=>x.id===wid); if(!w) return;
  w.status = 'Rejected';
  // refund
  const u = state.users[w.userId]; if(u){ u.balance = +((u.balance||0) + Number(w.amount)).toFixed(2); }
  saveState(); renderAdmin();
  sendToAdmin(`тЭМ ржЙржЗржержбрзНрж░ ржмрж╛рждрж┐рж▓\nID: ${w.id}\nUser: ${w.userId}\nрз│ ${w.amount}`);
  if(state.currentUserId === w.userId) showToast('тЭМ ржЖржкржирж╛рж░ ржЙржЗржержбрзНрж░ ржмрж╛рждрж┐рж▓ ржХрж░рж╛ рж╣рзЯрзЗржЫрзЗ (ржЯрж╛ржХрж╛ рж░рж┐ржлрж╛ржирзНржб рж╣рзЯрзЗржЫрзЗ)', 'error');
}

/* ========== TELEGRAM NOTIFY ========== */
function sendToAdmin(text){
  // Try direct fetch; may be blocked by CORS in some browsers
  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
    method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ chat_id: ADMIN_CHAT_ID, text })
  }).then(res=>{
    if(!res.ok){
      console.warn('Telegram notify failed', res.status);
      showToast('тЪая╕П ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи ржкрж╛ржарж╛ржирзЛ ржпрж╛ржпрж╝ржирж┐ (CORS)ред рж╕рж╛рж░рзНржнрж╛рж░-ржкрзНрж░ржХрзНрж╕рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред', 'error', 6000);
    }
  }).catch(err=>{
    console.warn('Telegram notify error', err);
    showToast('тЪая╕П ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо ржирзЛржЯрж┐ржлрж┐ржХрзЗрж╢ржи ржкрж╛ржарж╛ржирзЛ ржпрж╛ржпрж╝ржирж┐ (CORS)ред рж╕рж╛рж░рзНржнрж╛рж░-ржкрзНрж░ржХрзНрж╕рж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржиред', 'error', 6000);
  });
}

/* ========== REFER COPY ========== */
document.getElementById('copy-refer').addEventListener('click', ()=> {
  navigator.clipboard.writeText(document.getElementById('refer-link').value).then(()=> showToast('тЬЕ рж░рзЗржлрж╛рж░ рж▓рж┐ржВржХ ржХржкрж┐ рж╣рзЯрзЗржЫрзЗ', 'success'));
});

/* ========== JOIN CONFIRM ========== */
document.getElementById('confirmJoinBtn').addEventListener('click', ()=>{
  setJoined(true);
  showToast('тЬЕ ржзржирзНржпржмрж╛ржж! ржЖржкржирж┐ ржЬрзЯрзЗржи ржХрж░рзЗржЫрзЗржи', 'success');
  openTab('home');
});

/* ========== Render initial view ========== */
renderHome(); renderAccount();
if(joined_channel) openTab('home'); else openTab('join');

</script>
</body>
</html>