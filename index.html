<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üíé BD TM MINI BOT ‚Äî Premium</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Monetag SDK (‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶è‡¶° ‡¶ú‡¶®‡¶ø‡¶§ popups) -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>

  <style>
    /* Basic glass + glow theme */
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .glass {
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(10px);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: 0 8px 30px rgba(0,0,0,0.45);
    }
    .glow-text {
      background: linear-gradient(90deg,#00f2fe,#7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 20px rgba(124,58,237,0.8);
    }

    /* lighting animation (many places will use) */
    .lighting { animation: glowColors 6s infinite; }
    @keyframes glowColors {
      0%   { color:#34d399; text-shadow: 0 0 6px #34d399; }
      20%  { color:#60a5fa; text-shadow: 0 0 10px #60a5fa; }
      40%  { color:#a78bfa; text-shadow: 0 0 10px #a78bfa; }
      60%  { color:#fb7185; text-shadow: 0 0 12px #fb7185; }
      80%  { color:#f59e0b; text-shadow: 0 0 12px #f59e0b; }
      100% { color:#34d399; text-shadow: 0 0 6px #34d399; }
    }

    /* Floating emoji background */
    .emoji {
      position: fixed;
      font-size: 1.8rem;
      opacity: 0.14;
      pointer-events: none;
      user-select: none;
      animation: floatUp linear infinite;
    }
    .emoji.delay-1 { animation-duration: 18s; animation-delay: 0s; left:6%; }
    .emoji.delay-2 { animation-duration: 22s; animation-delay: 4s; left:28%; }
    .emoji.delay-3 { animation-duration: 20s; animation-delay: 2s; left:50%; }
    .emoji.delay-4 { animation-duration: 24s; animation-delay: 6s; left:72%; }
    .emoji.delay-5 { animation-duration: 30s; animation-delay: 8s; left:86%; }

    @keyframes floatUp {
      0% { transform: translateY(110vh) rotate(0deg) scale(.9); }
      100% { transform: translateY(-20vh) rotate(360deg) scale(1.2); }
    }

    /* Bomb effect when point add */
    .bomb {
      position: fixed;
      left: 50%;
      top: 48%;
      transform: translate(-50%,-50%);
      font-size: 3.4rem;
      pointer-events: none;
      z-index: 60;
      animation: bombAnim 900ms ease-out forwards;
      filter: drop-shadow(0 0 12px rgba(255,140,0,0.9));
    }
    @keyframes bombAnim {
      0% { opacity: 1; transform: translate(-50%,-50%) scale(.8) rotate(0deg); }
      60% { opacity: 1; transform: translate(-50%,-60%) scale(1.6) rotate(15deg); }
      100% { opacity: 0; transform: translate(-50%,-90%) scale(3) rotate(45deg); }
    }

    /* bottom nav */
    .bottom-nav { backdrop-filter: blur(8px); }
    .nav-btn {
      width: 100%;
      display:flex; flex-direction:column; align-items:center; gap:4px;
      padding:8px 6px; border-radius:12px;
      transition: transform .18s, box-shadow .18s;
      font-weight:600;
    }
    .nav-btn:active { transform: translateY(2px); }
    .nav-btn.active { box-shadow: 0 6px 20px rgba(124,58,237,0.24); transform: translateY(-4px); }

    /* toast */
    #toast {
      position: fixed; right: 16px; bottom: 96px;
      background: linear-gradient(90deg,#10b981,#06b6d4);
      padding: 10px 14px; border-radius: 12px; color:white; box-shadow:0 8px 30px rgba(0,0,0,0.4);
      z-index:70; display:none;
    }

    /* small responsive tweaks */
    @media (max-width:640px){
      .nav-label { font-size:11px; }
      .emoji { font-size:1.6rem; }
    }

    /* section show/hide transition */
    .tab { display:none; opacity:0; transform: translateY(12px); transition: all .35s; }
    .tab.show { display:block; opacity:1; transform: translateY(0); }

    /* table in admin */
    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding:8px 6px; border-bottom:1px solid rgba(255,255,255,0.06); text-align:left; font-size:13px; color:#f8fafc; }
    .small-muted { font-size:12px; opacity:.75; color:#e6eef8; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#071024] via-[#0b1226] to-[#2b0b3a] text-white relative">

  <!-- floating emojis (background decoration) -->
  <div class="emoji delay-1">üòÇ</div>
  <div class="emoji delay-2">ü§ñ</div>
  <div class="emoji delay-3">üòé</div>
  <div class="emoji delay-4">üò¥</div>
  <div class="emoji delay-5">üòç</div>

  <!-- HEADER -->
  <header class="w-full p-5 text-center">
    <div class="mx-auto max-w-xl glass p-4">
      <h1 class="text-3xl md:text-4xl font-extrabold glow-text">üíé BD TM MINI BOT</h1>
      <p class="small-muted mt-2">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶® ‚Ä¢ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®</p>
    </div>
  </header>

  <!-- MAIN -->
  <main class="px-4 pb-32 max-w-xl mx-auto">

    <!-- HOME TAB -->
    <section id="tab-home" class="tab show">
      <div class="glass p-5 mt-4 text-center">
        <div class="lighting text-sm">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
        <div class="text-4xl font-bold mt-2 lighting"><span id="ui-balance">0.00</span> ‡ß≥</div>
        <div class="mt-3 small-muted">‡¶Ü‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®: <span id="ui-ads-count">0</span> / 100</div>

        <div class="mt-4 flex gap-2 justify-center">
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank"
             class="px-4 py-2 bg-green-500 rounded-2xl font-semibold shadow-md">üì¢ ‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®</a>
          <button onclick="openTab('ads')" class="px-4 py-2 bg-cyan-500 rounded-2xl font-semibold">‚ñ∂ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>

        <div class="mt-4 small-muted">‡¶®‡ßã‡¶ü: Monetag SDK ‡¶π‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤ ‡¶™‡¶™‡¶Ü‡¶™ ‡¶Ü‡¶∏‡¶¨‡ßá‡•§ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤‡¶ø ‡¶®‡¶æ‡¶π‡¶≤‡ßá ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶ü ‡¶π‡¶¨‡ßá‡•§</div>
      </div>
    </section>

    <!-- ADS TAB -->
    <section id="tab-ads" class="tab">
      <div class="glass p-5 mt-4 text-center">
        <div class="flex items-center justify-between">
          <div class="lighting font-semibold">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
          <div class="small-muted">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶è‡¶°: ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‚Üí +0.20 ‡ß≥</div>
        </div>

        <div class="mt-6">
          <button id="btn-watch" onclick="startAdFlow()" class="w-full py-3 bg-blue-600 rounded-xl nav-btn lighting">
            ‚ñ∂ ‡¶è‡¶ñ‡¶®‡¶á ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
            <div class="text-xs small-muted mt-1">‡¶¨‡¶æ‡¶ï‡¶ø ‡¶è‡¶°: <span id="ads-left">100</span></div>
          </button>
        </div>

        <div id="ad-countdown" class="mt-5 small-muted"></div>
      </div>
    </section>

    <!-- WITHDRAW TAB -->
    <section id="tab-withdraw" class="tab">
      <div class="glass p-5 mt-4 text-black">
        <div class="flex items-center justify-between mb-3">
          <div class="font-semibold">üí≥ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</div>
          <div class="small-muted">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂:10 / ‡¶®‡¶ó‡¶¶:50 / ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú:20</div>
        </div>

        <div class="space-y-3">
          <select id="withdraw-method" class="w-full p-3 rounded">
            <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ (‡¶Æ‡¶ø‡¶®: ‡ßß‡ß¶‡ß≥)</option>
            <option value="nagad">‡¶®‡¶ó‡¶¶ (‡¶Æ‡¶ø‡¶®: ‡ß´‡ß¶‡ß≥)</option>
            <option value="recharge">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú (‡¶Æ‡¶ø‡¶®: ‡ß®‡ß¶‡ß≥)</option>
          </select>

          <input id="withdraw-number" type="text" placeholder="‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="w-full p-3 rounded" />
          <input id="withdraw-amount" type="number" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" class="w-full p-3 rounded" />

          <button onclick="submitWithdraw()" class="w-full py-3 bg-emerald-600 text-white rounded-xl">‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
          <div class="small-muted">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡¶ï‡ßá ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</div>
        </div>
      </div>
    </section>

    <!-- HISTORY TAB -->
    <section id="tab-history" class="tab">
      <div class="glass p-5 mt-4">
        <div class="font-semibold lighting">üìú ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</div>
        <div class="mt-3 small-muted">‡¶Ü‡¶™‡¶®‡¶ø ‡¶ì ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</div>

        <ul id="history-list" class="mt-3 space-y-3"></ul>
      </div>
    </section>

    <!-- REFER TAB -->
    <section id="tab-refer" class="tab">
      <div class="glass p-5 mt-4 text-center">
        <div class="font-semibold lighting">üéÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡ßü</div>
        <div class="mt-3 small-muted">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶¶‡¶ø‡¶® ‚Äî ‡¶§‡¶æ‡¶∞‡¶æ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá‡¶ì ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶™‡¶æ‡¶¨‡ßá‡¶® (‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡¶ø‡¶Æ‡ßÅ‡¶≤‡ßá‡¶∂‡¶®)‡•§</div>
        <div class="mt-4 flex gap-2 justify-center">
          <input id="refer-link" class="p-2 rounded text-black w-2/3" readonly value="https://t.me/BD_TM_MINI_BOT" />
          <button onclick="copyRefer()" class="px-3 py-2 bg-pink-600 rounded-lg">‡¶ï‡¶™‡¶ø</button>
        </div>
      </div>
    </section>

    <!-- ADMIN TAB -->
    <section id="tab-admin" class="tab">
      <div class="glass p-5 mt-4 text-black">
        <div class="font-semibold lighting">‚öôÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</div>
        <div class="mt-3 small-muted">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßÅ‡¶∞‡ßã ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá</div>

        <div id="admin-login-area" class="mt-4">
          <input id="admin-pass" type="password" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®" class="w-full p-3 rounded mb-3" />
          <button onclick="adminLogin()" class="w-full py-2 bg-yellow-500 rounded-lg">‡¶≤‡¶ó‡¶á‡¶®</button>
        </div>

        <div id="admin-area" class="hidden mt-4">
          <div class="mb-3">
            <div class="font-semibold">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</div>
            <div class="small-muted mt-2">‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: <span id="admin-user-count">0</span> ‚Ä¢ ‡¶Æ‡ßã‡¶ü ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ: <span id="admin-total-ads">0</span></div>
            <div class="small-muted">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ (‡¶∏‡¶¨ ‡¶Æ‡¶ø‡¶≤‡¶ø‡ßü‡ßá): <span id="admin-total-balance">0.00</span> ‡ß≥</div>
          </div>

          <div class="mt-2">
            <div class="font-semibold">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</div>
            <table class="table mt-2">
              <thead><tr><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø</th><th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th><th>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ</th><th>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</th></tr></thead>
              <tbody id="admin-users-tbody"></tbody>
            </table>
          </div>

          <div class="mt-4">
            <div class="font-semibold">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</div>
            <table class="table mt-2">
              <thead><tr><th>ID</th><th>‡¶á‡¶â‡¶ú‡¶æ‡¶∞</th><th>‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead>
              <tbody id="admin-withdraws-tbody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- bottom navigation (unique rounded buttons, lighting) -->
  <nav class="fixed bottom-4 left-4 right-4 bg-black/30 rounded-2xl p-2 flex justify-between gap-2 bottom-nav z-50 shadow-lg">
    <button id="nav-home" class="nav-btn lighting active" onclick="openTab('home')">
      <div style="font-size:18px">üè†</div><div class="nav-label text-xs">‡¶π‡ßã‡¶Æ</div>
    </button>
    <button id="nav-ads" class="nav-btn lighting" onclick="openTab('ads')">
      <div style="font-size:18px">‚ñ∂</div><div class="nav-label text-xs">‡¶è‡¶°</div>
    </button>
    <button id="nav-withdraw" class="nav-btn lighting" onclick="openTab('withdraw')">
      <div style="font-size:18px">üí≥</div><div class="nav-label text-xs">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</div>
    </button>
    <button id="nav-history" class="nav-btn lighting" onclick="openTab('history')">
      <div style="font-size:18px">üìú</div><div class="nav-label text-xs">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</div>
    </button>
    <button id="nav-refer" class="nav-btn lighting" onclick="openTab('refer')">
      <div style="font-size:18px">üéÅ</div><div class="nav-label text-xs">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</div>
    </button>
    <button id="nav-admin" class="nav-btn lighting" onclick="openTab('admin')">
      <div style="font-size:18px">‚öô</div><div class="nav-label text-xs">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</div>
    </button>
  </nav>

  <!-- toast + bomb container -->
  <div id="toast"></div>
  <div id="bomb-root"></div>

  <script>
    /******************************
     Config (‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ø‡¶æ ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá‡¶®)
    *******************************/
    const BOT_TOKEN = "8169503775:AAHFBx2dXbnXLZHje8MUzgsx5chWjxD9dKY";
    const ADMIN_CHAT_ID = "7691157254";
    const ADMIN_PASSWORD = "Sharif000";
    const AD_SECONDS = 15;          // ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ö‡ßá‡ßü‡ßá‡¶õ‡¶ø‡¶≤‡ßá‡¶® ‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
    const REWARD_PER_AD = 0.20;
    const DAILY_LIMIT = 100;
    const MIN_BKASH = 10;
    const MIN_NAGAD = 50;
    const MIN_RECHARGE = 20;

    /******************************
     State (localStorage persisted)
    *******************************/
    const STORAGE_KEY = "bdtm_state_v2";
    let state = {
      users: {},       // userId -> {id,balance,adsCount,createdAt}
      withdraws: [],   // {id,userId,method,number,amount,status,ts}
      currentUserId: null
    };

    // helper to generate unique id
    const uid = () => 'u' + Date.now().toString(36) + Math.floor(Math.random()*999).toString(36);

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        try { state = JSON.parse(raw); }
        catch (e) { console.error("state parse err", e); }
      }
      // ensure current user exists
      if (!state.currentUserId) {
        const newId = uid();
        state.currentUserId = newId;
        state.users[newId] = { id: newId, balance: 0, adsCount: 0, createdAt: new Date().toISOString() };
        saveState();
      }
      // daily reset of adsCount per user if date changed (we'll keep per-user day)
      const todayKey = (d=new Date()) => d.toISOString().slice(0,10);
      // use per-user adsDate record (optional) ‚Äî for simplicity not added; we keep persistent count for the day only per device
      // (If you want strict daily reset on midnight, server needed or additional date fields)
    }

    function saveState() { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    // current user ref
    function currentUser(){ return state.users[state.currentUserId]; }

    /******************************
     UI helpers
    *******************************/
    function showToast(text, ms=2800) {
      const t = document.getElementById("toast");
      t.innerText = text;
      t.style.display = "block";
      t.style.opacity = "1";
      setTimeout(()=>{ t.style.opacity = "0"; setTimeout(()=>t.style.display="none",400); }, ms);
    }

    function showBomb() {
      const root = document.getElementById("bomb-root");
      const el = document.createElement("div");
      el.className = "bomb";
      el.innerText = "üí£üí•";
      root.appendChild(el);
      setTimeout(()=>el.remove(),900);
    }

    function formatBN(n) {
      try {
        return n.toLocaleString('bn-BD',{minimumFractionDigits:2, maximumFractionDigits:2});
      } catch(e) { return Number(n).toFixed(2); }
    }

    /******************************
     Tab handling
    *******************************/
    function openTab(key) {
      document.querySelectorAll('.tab').forEach(s => { s.classList.remove('show'); s.classList.add('hidden'); });
      const el = document.getElementById('tab-' + key);
      if (el) { el.classList.remove('hidden'); setTimeout(()=>el.classList.add('show'),20); }
      // nav active classes
      ['home','ads','withdraw','history','refer','admin'].forEach(k=>{
        const b = document.getElementById('nav-'+k);
        if(!b) return;
        if(k===key) b.classList.add('active'); else b.classList.remove('active');
      });
      if (key === 'ads') updateAdsUI();
      if (key === 'history') renderHistory();
      if (key === 'admin') renderAdmin();
      if (key === 'home') renderHome();
    }

    /******************************
     Ad flow (Monetag integration)
    *******************************/
    let adRunning = false;
    // compute remaining ads (per current user)
    function adsRemaining() {
      return Math.max(0, DAILY_LIMIT - (currentUser().adsCount || 0));
    }

    function updateAdsUI(){
      document.getElementById('ads-left').innerText = adsRemaining();
      document.getElementById('ui-ads-count').innerText = currentUser().adsCount || 0;
    }

    function startAdFlow(){
      if (adRunning) return;
      if (adsRemaining() <= 0) { alert('‚ö†Ô∏è ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (100)'); return; }

      // Try call Monetag if available
      if (typeof show_9842278 === "function") {
        try { show_9842278(); } catch(e) { console.warn('Monetag call failed', e); }
      } // else we'll still simulate countdown ‚Äî user informed

      // start local timer
      adRunning = true;
      let left = AD_SECONDS;
      const countdownEl = document.getElementById('ad-countdown');
      const btn = document.getElementById('btn-watch');
      btn.disabled = true;
      btn.style.opacity = '0.7';
      countdownEl.innerText = `‚è≥ ${left} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ö‡¶≤‡¶õ‡ßá...`;
      const tick = setInterval(()=>{
        left--;
        if (left > 0) { countdownEl.innerText = `‚è≥ ${left} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ö‡¶≤‡¶õ‡ßá...`; return; }
        clearInterval(tick);
        adRunning = false;
        btn.disabled = false;
        btn.style.opacity = '1';
        countdownEl.innerText = `‚úÖ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶∂‡ßá‡¶∑! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`;
        // reward to current user
        const u = currentUser();
        u.balance = +(u.balance + REWARD_PER_AD).toFixed(2);
        u.adsCount = (u.adsCount || 0) + 1;
        saveState();
        renderHome();
        updateAdsUI();
        // fx: bomb and toast
        showBomb();
        showToast(`‚úÖ +${REWARD_PER_AD} ‡ß≥ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!`);
        // admin notify (optional small message)
        telegramNotify(`üì¢ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ:\n‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${u.id}\n‡¶Æ‡ßã‡¶ü ‡¶è‡¶°: ${u.adsCount}\n‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ${formatBN(u.balance)} ‡ß≥`);
      }, 1000);
    }

    /******************************
     Withdraw flow
    *******************************/
    function submitWithdraw(){
      const method = document.getElementById('withdraw-method').value;
      const number = (document.getElementById('withdraw-number').value || '').trim();
      const amount = parseFloat(document.getElementById('withdraw-amount').value);
      if (!number || isNaN(amount)) { alert('‚ö† ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®'); return; }

      let min = MIN_BKASH;
      if (method === 'nagad') min = MIN_NAGAD;
      if (method === 'recharge') min = MIN_RECHARGE;

      const u = currentUser();
      if (amount < min) { alert(`‚ö† ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ${min} ‡ß≥ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ (${method})`); return; }
      if (amount > u.balance) { alert('‚ö† ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á'); return; }

      // deduct now (as per your earlier design)
      u.balance = +(u.balance - amount).toFixed(2);

      const req = {
        id: 'W' + Date.now().toString(36) + Math.floor(Math.random()*999),
        userId: u.id,
        method, number, amount, status:'Pending',
        ts: new Date().toISOString()
      };
      state.withdraws.push(req);
      saveState();
      renderHistory();
      renderAdmin();

      // notify admin via Telegram (Bangla)
      const adminMsg = `üì© ‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß\nID: ${req.id}\n‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${u.id}\n‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø: ${method}\n‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ‡ß≥${formatBN(req.amount)}\n‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: ${req.number}`;
      telegramNotify(adminMsg);

      showToast('üì© ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (Pending)');
      renderHome();
    }

    /******************************
     History rendering
    *******************************/
    function renderHistory(){
      const ul = document.getElementById('history-list');
      ul.innerHTML = '';
      const sorted = state.withdraws.slice().reverse();
      if (sorted.length === 0) {
        ul.innerHTML = '<li class="small-muted">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§</li>'; return;
      }
      sorted.forEach(r=>{
        const li = document.createElement('li');
        li.className = 'p-3 bg-white/5 rounded';
        li.innerHTML = `<div class="flex justify-between items-start">
          <div><b>ID:</b> ${r.id}<br><span class="small-muted">${r.method} ‚Üí ${r.number}</span></div>
          <div class="text-right"><div class="font-medium">‡ß≥ ${formatBN(r.amount)}</div><div class="small-muted">${r.status}</div></div>
        </div>
        <div class="small-muted mt-2">‡¶∏‡¶Æ‡¶Ø‡¶º: ${new Date(r.ts).toLocaleString()}</div>`;
        ul.appendChild(li);
      });
    }

    /******************************
     Admin area rendering + actions
    ***************
