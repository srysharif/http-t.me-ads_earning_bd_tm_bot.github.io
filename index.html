<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BD TM MINI BOT</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Monetag -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>

  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .glass { background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); backdrop-filter: blur(12px); border-radius:16px; }
    .lighting { animation: glow 8s infinite alternate ease-in-out; }
    @keyframes glow {
      0% { color:#60a5fa; text-shadow:0 0 10px #60a5fa; }
      25% { color:#a78bfa; text-shadow:0 0 12px #a78bfa; }
      50% { color:#34d399; text-shadow:0 0 12px #34d399; }
      75% { color:#f59e0b; text-shadow:0 0 14px #f59e0b; }
      100%{ color:#fb7185; text-shadow:0 0 16px #fb7185; }
    }
    .bottom { position:fixed; left:0; right:0; bottom:0; padding:10px; background:rgba(0,0,0,0.25); backdrop-filter:blur(8px); }
    .navbtn { width:100%; padding:10px 8px; border-radius:14px; font-weight:700; }
    .emoji { position:fixed; font-size:2rem; opacity:.12; user-select:none; pointer-events:none; animation:float 24s linear infinite; }
    .emoji.e2{ left:25%; animation-duration:28s; }
    .emoji.e3{ left:55%; animation-duration:20s; }
    .emoji.e4{ left:80%; animation-duration:26s; }
    @keyframes float { 0%{ transform:translateY(110vh) rotate(0) } 100%{ transform:translateY(-20vh) rotate(360deg) } }
    .bomb { position:fixed; left:50%; top:45%; transform:translate(-50%,-50%); font-size:3rem; z-index:40; animation:bomb 1s ease forwards; }
    @keyframes bomb { 0%{ opacity:0; transform:translate(-50%,-50%) scale(.8) } 50%{ opacity:1; transform:translate(-50%,-55%) scale(1.6) } 100%{ opacity:0; transform:translate(-50%,-80%) scale(2.4) } }
    .tab { display:none; opacity:0; transform:translateY(8px); transition:all .3s; }
    .tab.show { display:block; opacity:1; transform:translateY(0); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#091535] via-[#0b1120] to-[#2b0b3a] text-white pb-28">

  <div class="emoji">ЁЯШН</div><div class="emoji e2">ЁЯдЦ</div><div class="emoji e3">ЁЯШВ</div><div class="emoji e4">ЁЯШО</div>

  <header class="p-5 text-center">
    <div class="glass p-4 max-w-xl mx-auto">
      <h1 class="text-3xl font-extrabold lighting">ЁЯТО BD TM MINI BOT</h1>
      <p class="opacity-80 text-sm">ржПржб ржжрзЗржЦрзЗ ржЖрзЯ ржХрж░рзБржи тАв рж░рзЗржлрж╛рж░ ржХрж░рзЗ ржмрзЛржирж╛рж╕ ржкрж╛ржи</p>
    </div>
  </header>

  <main class="px-4 max-w-xl mx-auto space-y-4">
    <!-- Login/Register -->
    <section id="tab-login" class="tab show">
      <div class="glass p-5">
        <h2 class="text-xl font-bold lighting">ЁЯФР ржПржХрж╛ржЙржирзНржЯ ржЪрж╛рж▓рзБ ржХрж░рзБржи</h2>
        <p class="text-sm opacity-80 mt-1">ржирж┐ржЪрзЗ ржЖржкржирж╛рж░ ржЯрзЗрж▓рж┐ржЧрзНрж░рж╛ржо Username ржУ Numeric ID ржжрж┐ржиред (ID ржкрзЗрждрзЗ @userinfobot)</p>
        <div class="mt-4 space-y-3">
          <input id="username" class="w-full p-3 rounded text-black" placeholder="Username (without @)" />
          <input id="tgId" class="w-full p-3 rounded text-black" placeholder="Numeric Telegram ID" />
          <button onclick="register()" class="w-full py-3 bg-emerald-600 rounded-lg font-semibold">ЁЯЪА рж╢рзБрж░рзБ ржХрж░рзБржи</button>
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank" class="block text-center underline text-sm mt-1">ЁЯУв ржЖржЧрзЗ ржЖржорж╛ржжрзЗрж░ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рзБржи</a>
        </div>
      </div>
    </section>

    <!-- Home -->
    <section id="tab-home" class="tab">
      <div class="glass p-5 text-center">
        <div class="lighting">ржмрж░рзНрждржорж╛ржи ржмрзНржпрж╛рж▓рзЗржирзНрж╕</div>
        <div class="text-4xl font-extrabold mt-1"><span id="ui-balance">0.00</span> рз│</div>
        <div class="mt-2 text-sm opacity-80">ржЖржЬ ржжрзЗржЦрж╛: <span id="ui-ads">0</span> / 100</div>
        <div class="mt-3 flex justify-center gap-2">
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank" class="px-4 py-2 bg-green-600 rounded-xl font-semibold">ЁЯУв ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи</a>
          <button onclick="openTab('ads')" class="px-4 py-2 bg-blue-600 rounded-xl font-semibold">тЦ╢ ржПржб ржжрзЗржЦрзБржи</button>
        </div>
        <div id="joinStatus" class="text-xs opacity-70 mt-2"></div>
      </div>
    </section>

    <!-- Ads -->
    <section id="tab-ads" class="tab">
      <div class="glass p-5 text-center">
        <div class="flex justify-between">
          <div class="font-semibold lighting">ржмрж┐ржЬрзНржЮрж╛ржкржи</div>
          <div class="text-sm opacity-80">рззрзл рж╕рзЗржХрзЗржирзНржб + рззрзн рж╕рзЗржХрзЗржирзНржбрзЗ ржкрзЗржорзЗржирзНржЯ</div>
        </div>
        <div class="mt-4">
          <button id="btn-start-ad" onclick="startAd()" class="w-full py-3 bg-blue-600 rounded-xl font-bold">тЦ╢ ржПржЦржиржЗ ржжрзЗржЦрзБржи</button>
        </div>
        <div id="adTimer" class="mt-3 text-sm opacity-80"></div>
      </div>
    </section>

    <!-- Withdraw -->
    <section id="tab-withdraw" class="tab">
      <div class="glass p-5">
        <h2 class="text-xl font-bold lighting">ЁЯТ│ ржЯрж╛ржХрж╛ ржЙрждрзНрждрзЛрж▓ржи</h2>
        <div class="text-xs opacity-80 mb-2">ржмрж┐ржХрж╛рж╢ рззрзжрз│ тАв ржиржЧржж рзлрзжрз│ тАв рж░рж┐ржЪрж╛рж░рзНржЬ рзирзжрз│</div>
        <div class="space-y-3">
          <select id="method" class="w-full p-3 rounded text-black">
            <option value="bkash">ржмрж┐ржХрж╛рж╢</option>
            <option value="nagad">ржиржЧржж</option>
            <option value="recharge">ржорзЛржмрж╛ржЗрж▓ рж░рж┐ржЪрж╛рж░рзНржЬ</option>
          </select>
          <input id="number" class="w-full p-3 rounded text-black" placeholder="ржиржорзНржмрж░" />
          <input id="amount" type="number" class="w-full p-3 rounded text-black" placeholder="ржкрж░рж┐ржорж╛ржг" />
          <button onclick="withdraw()" class="w-full py-3 bg-emerald-600 rounded-xl font-semibold">ЁЯУй рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржи</button>
        </div>
      </div>
    </section>

    <!-- History -->
    <section id="tab-history" class="tab">
      <div class="glass p-5">
        <h2 class="text-xl font-bold lighting">ЁЯУЬ рж╣рж┐рж╕рзНржЯрзНрж░рж┐</h2>
        <ul id="history" class="mt-3 space-y-2 text-sm"></ul>
      </div>
    </section>

    <!-- Refer -->
    <section id="tab-refer" class="tab">
      <div class="glass p-5 text-center">
        <div class="font-semibold lighting">ЁЯОБ рж░рзЗржлрж╛рж░</div>
        <div class="mt-3 flex justify-center gap-2">
          <input id="ref" class="p-2 rounded text-black w-2/3" readonly value="https://t.me/BD_TM_MINI_BOT" />
          <button onclick="copyRef()" class="px-3 py-2 bg-pink-600 rounded-lg">ржХржкрж┐</button>
        </div>
      </div>
    </section>
  </main>

  <nav class="bottom">
    <div class="max-w-xl mx-auto grid grid-cols-5 gap-2">
      <button class="navbtn bg-white/10" onclick="openTab('home')">ЁЯПа рж╣рзЛржо</button>
      <button class="navbtn bg-white/10" onclick="openTab('ads')">тЦ╢ ржПржб</button>
      <button class="navbtn bg-white/10" onclick="openTab('withdraw')">ЁЯТ│ ржЙржЗржержбрзНрж░</button>
      <button class="navbtn bg-white/10" onclick="openTab('history')">ЁЯУЬ рж╣рж┐рж╕рзНржЯрзНрж░рж┐</button>
      <a class="navbtn bg-white/10 text-center" href="/admin.html">тЪЩ ржПржбржорж┐ржи</a>
    </div>
  </nav>

  <div id="bomb"></div>

<script>
const API = location.origin + "/api";
let SESSION = { username:null, tgId:null, joined:false, user:null };

function openTab(key){
  document.querySelectorAll(".tab").forEach(x=>{ x.classList.remove("show"); x.style.display="none"; });
  const el = document.getElementById("tab-"+key);
  if(el){ el.style.display="block"; setTimeout(()=>el.classList.add("show"),10); }
}

function bomb(){
  const b = document.getElementById("bomb");
  const el = document.createElement("div");
  el.className = "bomb";
  el.textContent = "ЁЯТгЁЯТе";
  b.appendChild(el);
  setTimeout(()=>el.remove(),1000);
}

function fmt(n){ return Number(n||0).toFixed(2); }

async function post(url, data){
  const r = await fetch(url,{ method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(data||{}) });
  return await r.json();
}

async function register(){
  const username = document.getElementById("username").value.trim().replace(/^@/,"");
  const tgId = document.getElementById("tgId").value.trim();
  if(!username || !tgId) return alert("Username ржУ Numeric Telegram ID ржжрж┐ржи");

  const r = await post(API+"/register", { username, tgId });
  if(!r.ok) return alert(r.error||"рж░рзЗржЬрж┐рж╕рзНржЯрж╛рж░ ржмрзНржпрж░рзНрже");

  SESSION.username = username;
  SESSION.tgId = tgId;
  SESSION.joined = r.joined;
  SESSION.user = r.user;

  if(!r.joined){
    document.getElementById("joinStatus").innerHTML = "тЭМ ржЖржкржирж┐ ржПржЦржирзЛ ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржХрж░рзЗржиржирж┐ред ржЖржЧрзЗ ржЬрзЯрзЗржи ржХрж░рзБржиред";
  }else{
    document.getElementById("joinStatus").innerHTML = "тЬЕ ржЪрзНржпрж╛ржирзЗрж▓ ржЬрзЯрзЗржи ржХрж░рж╛ ржЖржЫрзЗред";
  }

  document.getElementById("ui-balance").innerText = fmt(r.user.balance);
  document.getElementById("ui-ads").innerText = r.user.adsCountToday;
  openTab("home");
}

async function startAd(){
  if(!SESSION.tgId) return openTab("login");

  const check = await post(API+"/check-join", { username:SESSION.username, tgId:SESSION.tgId });
  if(!check.ok || !check.joined){
    alert("ржЪрзНржпрж╛ржирзЗрж▓рзЗ ржЬрзЯрзЗржи ржирж╛ ржХрж░рж▓рзЗ ржХрж╛ржЬ рж╣ржмрзЗ ржирж╛ред");
    return;
  }

  const s = await post(API+"/ad/start", { username:SESSION.username, tgId:SESSION.tgId });
  if(!s.ok) return alert(s.error||"ржПржб рж╢рзБрж░рзБ рж╣рзЯржирж┐");

  // Monetag popup (рззрзлрж╕рзЗржХ)
  if(typeof show_9842278 === "function"){ try{ show_9842278(); }catch(e){} }

  const adTimer = document.getElementById("adTimer");
  let left = 17;
  adTimer.innerText = `тП│ ржЪрж▓ржЫрзЗ... ${left}s`;
  const t = setInterval(()=>{
    left--;
    adTimer.innerText = `тП│ ржЪрж▓ржЫрзЗ... ${left}s`;
    if(left<=0){
      clearInterval(t);
      adTimer.innerText = "тЬЕ ржХрзНрж░рзЗржбрж┐ржЯ ржжрж┐ржЪрзНржЫрж┐...";
      completeAd(s.ticketId);
    }
  },1000);
}

async function completeAd(ticketId){
  const c = await post(API+"/ad/complete", { username:SESSION.username, tgId:SESSION.tgId, ticketId });
  if(!c.ok) return alert(c.error||"ржХрзНрж░рзЗржбрж┐ржЯ ржмрзНржпрж░рзНрже");
  document.getElementById("ui-balance").innerText = fmt(c.balance);
  document.getElementById("ui-ads").innerText = c.adsCountToday;
  bomb();
  alert("тЬЕ +0.20 рз│ ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ!");
}

async function withdraw(){
  if(!SESSION.tgId) return openTab("login");
  const method = document.getElementById("method").value;
  const number = document.getElementById("number").value.trim();
  const amount = parseFloat(document.getElementById("amount").value);

  if(!number || !amount) return alert("рж╕ржм рждржерзНржп ржжрж┐ржи");
  const w = await post(API+"/withdraw", { username:SESSION.username, tgId:SESSION.tgId, method, number, amount });
  if(!w.ok) return alert(w.error||"рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржмрзНржпрж░рзНрже");

  document.getElementById("ui-balance").innerText = fmt(w.balance);
  alert("ЁЯУй ржЙржЗржержбрзНрж░ рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржкрж╛ржарж╛ржирзЛ рж╣рзЯрзЗржЫрзЗ (Pending)ред");
  loadHistory();
}

async function loadHistory(){
  if(!SESSION.tgId) return;
  const h = await post(API+"/history", { username:SESSION.username, tgId:SESSION.tgId });
  if(!h.ok) return;
  const ul = document.getElementById("history");
  ul.innerHTML = "";
  h.history.forEach(x=>{
    const li = document.createElement("li");
    li.className = "p-3 bg-white/5 rounded";
    li.innerHTML = `<div class="flex justify-between">
      <div><b>${x.id}</b><div class="text-xs opacity-70">${x.method} тЖТ ${x.number}</div></div>
      <div class="text-right"><div>рз│ ${fmt(x.amount)}</div><div class="text-xs opacity-70">${x.status}</div></div>
    </div>
    <div class="text-xs opacity-70 mt-1">${new Date(x.createdAt).toLocaleString()}</div>`;
    ul.appendChild(li);
  });
}

</script>
</body>
</html>