<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BD TM MINI BOT</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Monetag SDK: 15s real popup -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .glass{background:rgba(255,255,255,.06);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.45)}
    .lighting{animation:glowColors 8s infinite alternate ease-in-out}
    @keyframes glowColors{
      0%{color:#34d399;text-shadow:0 0 12px #34d399}
      25%{color:#60a5fa;text-shadow:0 0 14px #60a5fa}
      50%{color:#a78bfa;text-shadow:0 0 16px #a78bfa}
      75%{color:#f59e0b;text-shadow:0 0 18px #f59e0b}
      100%{color:#fb7185;text-shadow:0 0 20px #fb7185}
    }
    .tab{display:none;opacity:0;transform:translateY(10px);transition:all .3s}
    .tab.show{display:block;opacity:1;transform:translateY(0)}
    .nav-btn{width:100%;display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 6px;border-radius:12px;font-weight:700;transition:.18s}
    .nav-btn.active{box-shadow:0 8px 24px rgba(124,58,237,.25);transform:translateY(-3px)}
    .bomb{position:fixed;left:50%;top:46%;transform:translate(-50%,-50%);font-size:3rem;z-index:60;animation:bombAnim .9s ease-out forwards;filter:drop-shadow(0 0 12px rgba(255,140,0,.9))}
    @keyframes bombAnim{0%{opacity:1;transform:translate(-50%,-50%) scale(.8)}60%{opacity:1;transform:translate(-50%,-62%) scale(1.6)}100%{opacity:0;transform:translate(-50%,-90%) scale(3)}}
    #toast{position:fixed;right:14px;bottom:92px;z-index:70;display:none;background:linear-gradient(90deg,#10b981,#06b6d4);color:#fff;padding:10px 14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,.4)}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:8px 6px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;font-size:13px}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#071024] via-[#0b1226] to-[#2b0b3a] text-white">

  <!-- Header -->
  <header class="w-full p-5 text-center">
    <div class="max-w-xl mx-auto glass p-4">
      <h1 class="text-3xl font-extrabold lighting">üíé BD TM MINI BOT</h1>
      <p class="opacity-80 text-sm">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶® ‚Ä¢ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®</p>
    </div>
  </header>

  <!-- Login + Join Gate -->
  <section class="max-w-xl mx-auto px-4">
    <div id="gate-card" class="glass p-4">
      <h2 class="font-bold mb-2 lighting">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® (Telegram)</h2>
      <!-- Replace data-telegram-login with your bot username; using your link name -->
      <div id="tg-login" class="my-2">
        <script async src="https://telegram.org/js/telegram-widget.js?22"
                data-telegram-login="BD_TM_MINI_BOT"
                data-size="large"
                data-userpic="false"
                data-onauth="onTelegramAuth(user)"
                data-request-access="write"></script>
      </div>

      <div class="mt-4">
        <a id="joinBtn" href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank"
           class="inline-block px-4 py-2 bg-green-600 rounded-xl font-semibold">üì¢ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶¶‡¶ø‡¶®</a>
      </div>
      <p class="text-xs opacity-80 mt-2">‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶®‡¶æ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶è‡¶¨‡¶Ç ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶ü ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§</p>
    </div>
  </section>

  <!-- Main -->
  <main id="app" class="px-4 pb-32 max-w-xl mx-auto hidden">

    <!-- Home -->
    <section id="tab-home" class="tab show">
      <div class="glass p-5 mt-4 text-center">
        <div class="lighting">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
        <div class="text-4xl font-extrabold mt-1 lighting"><span id="ui-balance">0.00</span> ‡ß≥</div>
        <div class="mt-1 text-sm opacity-80">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶°: <span id="ui-ads-count">0</span> / 100</div>

        <div class="mt-4 flex flex-col gap-3">
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank"
             class="px-4 py-2 bg-green-500 rounded-2xl font-semibold">üì¢ ‡¶Ö‡¶´‡¶ø‡¶∏‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</a>
          <button onclick="openTab('ads')" class="px-4 py-2 bg-cyan-500 rounded-2xl font-semibold">‚ñ∂ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>
      </div>
    </section>

    <!-- Ads -->
    <section id="tab-ads" class="tab">
      <div class="glass p-5 mt-4 text-center">
        <div class="lighting font-semibold">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</div>
        <div class="text-xs opacity-80 mt-1">Monetag ‡¶™‡¶™‡¶Ü‡¶™ ~ ‡ßß‡ß´‡¶∏‡ßá‡¶ï ‡¶ö‡¶≤‡¶¨‡ßá ‚Ä¢ ‡¶∞‡¶ø‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡ßß‡ß≠‡¶∏‡ßá‡¶ï ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã ‡¶Ø‡ßã‡¶ó</div>

        <button id="btn-watch" onclick="startAdFlow()" class="w-full py-3 mt-5 bg-blue-600 rounded-xl font-semibold">
          ‚ñ∂ ‡¶è‡¶ñ‡¶®‡¶á ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
        <div id="ad-countdown" class="mt-3 text-sm opacity-90"></div>
      </div>
    </section>

    <!-- Withdraw -->
    <section id="tab-withdraw" class="tab">
      <div class="glass p-5 mt-4">
        <div class="font-semibold mb-2 lighting">üí≥ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</div>
        <div class="text-xs opacity-75 mb-3">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ: ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡ßß‡ß¶‡ß≥ ‚Ä¢ ‡¶®‡¶ó‡¶¶ ‡ß´‡ß¶‡ß≥ ‚Ä¢ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡ß®‡ß¶‡ß≥</div>

        <select id="wd-method" class="w-full p-3 rounded text-black">
          <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
          <option value="nagad">‡¶®‡¶ó‡¶¶</option>
          <option value="recharge">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</option>
        </select>
        <input id="wd-number" class="w-full p-3 rounded mt-3 text-black" placeholder="‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®"/>
        <input id="wd-amount" type="number" class="w-full p-3 rounded mt-3 text-black" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£"/>

        <button onclick="submitWithdraw()" class="w-full py-3 mt-4 bg-emerald-600 rounded-xl font-semibold">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
      </div>
    </section>

    <!-- History -->
    <section id="tab-history" class="tab">
      <div class="glass p-5 mt-4">
        <div class="font-semibold lighting">üìú ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏</div>
        <ul id="history-list" class="mt-3 space-y-3 text-sm"></ul>
      </div>
    </section>

    <!-- Refer -->
    <section id="tab-refer" class="tab">
      <div class="glass p-5 mt-4 text-center">
        <div class="font-semibold lighting">üéÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶Ü‡ßü</div>
        <div class="mt-3 text-sm opacity-80">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®</div>
        <div class="mt-4 flex gap-2 justify-center">
          <input id="ref-link" class="p-2 rounded text-black w-2/3" readonly value="https://t.me/BD_TM_MINI_BOT"/>
          <button onclick="copyRefer()" class="px-3 py-2 bg-pink-600 rounded-lg">‡¶ï‡¶™‡¶ø</button>
        </div>
      </div>
    </section>

    <!-- Admin -->
    <section id="tab-admin" class="tab">
      <div class="glass p-5 mt-4">
        <div class="lighting font-semibold">‚öôÔ∏è ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</div>

        <div id="admin-login" class="mt-3">
          <input id="admin-pass" type="password" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®" class="w-full p-3 rounded text-black"/>
          <button onclick="adminLogin()" class="w-full py-2 mt-2 bg-yellow-500 rounded-lg font-semibold">‡¶≤‡¶ó‡¶á‡¶®</button>
        </div>

        <div id="admin-area" class="hidden mt-4">
          <div class="font-semibold mb-2">‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™</div>
          <div class="text-sm opacity-80">‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: <span id="admin-user-count">0</span> ‚Ä¢ ‡¶Æ‡ßã‡¶ü ‡¶è‡¶°: <span id="admin-total-ads">0</span></div>
          <div class="text-sm opacity-80 mb-3">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: <span id="admin-total-balance">0.00</span> ‡ß≥</div>

          <div class="font-semibold mt-2">‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</div>
          <table class="table mt-1">
            <thead><tr><th>ID</th><th>Username</th><th>‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th><th>‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶°</th></tr></thead>
            <tbody id="admin-users-tbody"></tbody>
          </table>

          <div class="font-semibold mt-4">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</div>
          <table class="table mt-1">
            <thead><tr><th>ID</th><th>User</th><th>‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</th><th>‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</th><th>‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th><th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th></tr></thead>
            <tbody id="admin-wd-tbody"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-4 left-4 right-4 bg-black/30 rounded-2xl p-2 flex justify-between gap-2">
    <button id="nav-home" class="nav-btn active" onclick="openTab('home')">üè†<span class="text-xs">‡¶π‡ßã‡¶Æ</span></button>
    <button id="nav-ads" class="nav-btn" onclick="openTab('ads')">‚ñ∂<span class="text-xs">‡¶è‡¶°</span></button>
    <button id="nav-withdraw" class="nav-btn" onclick="openTab('withdraw')">üí≥<span class="text-xs">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span></button>
    <button id="nav-history" class="nav-btn" onclick="openTab('history')">üìú<span class="text-xs">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</span></button>
    <button id="nav-refer" class="nav-btn" onclick="openTab('refer')">üéÅ<span class="text-xs">‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span></button>
    <button id="nav-admin" class="nav-btn" onclick="openTab('admin')">‚öôÔ∏è<span class="text-xs">‡¶è‡¶°‡¶Æ‡¶ø‡¶®</span></button>
  </nav>

  <!-- Toast + Bomb -->
  <div id="toast"></div>
  <div id="bomb-root"></div>

<script>
/* ====== CONFIG (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ) ====== */
const BOT_TOKEN     = "8169503775:AAHFBx2dXbnXLZHje8MUzgsx5chWjxD9dKY";
const ADMIN_CHAT_ID = "7691157254";
const ADMIN_PASSWORD = "Sharif000";
const CHANNEL_ID_OR_USERNAME = "@ADS_EARNING_BD_TM_CHANNEL"; // Join check
const DAILY_LIMIT   = 100;
const REWARD_PER_AD = 0.20;
const MONETAG_SECONDS = 15; // info only
const REWARD_AFTER   = 17;  // ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°

/* ====== STATE (localStorage) ====== */
const STORE_KEY = "bdtm_premium_state_v3";
let state = {
  users: {},            // tgId -> {id, username, balance, adsToday, lastDay}
  currentUserId: null,
  withdraws: []         // {id,userId,username,method,number,amount,status,ts}
};

function loadState(){
  const raw = localStorage.getItem(STORE_KEY);
  if(raw){ try{ state = JSON.parse(raw) }catch(e){} }
}
function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }
function currentUser(){ return state.users[state.currentUserId] || null; }
function todayKey(){ return new Date().toISOString().slice(0,10); }

/* ====== UI Helpers ====== */
function openTab(key){
  document.querySelectorAll('.tab').forEach(s=>{s.classList.remove('show')});
  const t = document.getElementById('tab-'+key);
  if(t) t.classList.add('show');
  ['home','ads','withdraw','history','refer','admin'].forEach(k=>{
    const b=document.getElementById('nav-'+k); if(b) b.classList.remove('active');
  });
  const nb=document.getElementById('nav-'+key); if(nb) nb.classList.add('active');
  if(key==='history') renderHistory();
  if(key==='admin') renderAdmin();
  if(key==='home') renderHome();
}
function showToast(text,ms=2600){
  const t=document.getElementById('toast');
  t.textContent=text; t.style.display='block'; t.style.opacity='1';
  setTimeout(()=>{ t.style.opacity='0'; setTimeout(()=>t.style.display='none',400); }, ms);
}
function bomb(){
  const r=document.getElementById('bomb-root');
  const el=document.createElement('div'); el.className='bomb'; el.textContent='üí£üí•';
  r.appendChild(el); setTimeout(()=>el.remove(),900);
}
function fmt(n){ try{return n.toLocaleString('bn-BD',{minimumFractionDigits:2,maximumFractionDigits:2})}catch(_){return (+n).toFixed(2)} }

/* ====== Telegram Login ====== */
async function onTelegramAuth(user){
  // user = {id, username, first_name, last_name, photo_url, auth_date, hash}
  loadState();
  const id = String(user.id);
  const username = user.username ? '@'+user.username : (user.first_name || 'User') ;
  if(!state.users[id]){
    state.users[id] = { id, username, balance:0, adsToday:0, lastDay: todayKey() };
  }
  state.currentUserId = id;
  saveState();
  await enforceJoinGate(); // check channel join
  enterApp();
}
function enterApp(){
  document.getElementById('gate-card').classList.add('hidden');
  document.getElementById('app').classList.remove('hidden');
  renderHome();
}

/* ====== Channel Join Check ====== */
async function enforceJoinGate(){
  const u = currentUser();
  if(!u){ return; }
  try{
    const url = `https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${encodeURIComponent(CHANNEL_ID_OR_USERNAME)}&user_id=${u.id}`;
    const res = await fetch(url);
    const data = await res.json();
    const okStatuses = ['member','administrator','creator','owner'];
    const status = data?.result?.status || 'left';
    if(!okStatuses.includes(status)){
      // keep app hidden
      document.getElementById('app').classList.add('hidden');
      document.getElementById('gate-card').classList.remove('hidden');
      showToast('üì¢ ‡¶Ü‡¶ó‡ßá ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
      return false;
    }
    return true;
  }catch(e){
    // if API blocked, allow but warn
    showToast('‚ö†Ô∏è Join ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶ó‡ßá‡¶≤ ‡¶®‡¶æ, ‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§');
    return true;
  }
}

/* ====== Daily Reset ====== */
function dailyResetIfNeeded(){
  const u=currentUser(); if(!u) return;
  const tk=todayKey();
  if(u.lastDay!==tk){ u.lastDay=tk; u.adsToday=0; saveState(); }
}

/* ====== Home Render ====== */
function renderHome(){
  dailyResetIfNeeded();
  const u=currentUser(); if(!u) return;
  document.getElementById('ui-balance').textContent = fmt(u.balance);
  document.getElementById('ui-ads-count').textContent = u.adsToday||0;
}

/* ====== Ads Flow ====== */
let adRunning=false;
async function startAdFlow(){
  const joined = await enforceJoinGate(); if(!joined) return;
  const u=currentUser(); if(!u){ showToast('üîê ‡¶Ü‡¶ó‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }
  dailyResetIfNeeded();
  if((u.adsToday||0) >= DAILY_LIMIT){ showToast('‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ 100 ‡¶è‡¶° ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑'); return; }
  if(adRunning) return;
  adRunning=true;
  const btn=document.getElementById('btn-watch'); const cd=document.getElementById('ad-countdown');
  btn.disabled=true; btn.style.opacity='.7';

  // Trigger Monetag popup (15s typical)
  try{ if(typeof show_9842278==='function') show_9842278(); }catch(_){}

  let left = REWARD_AFTER; // 17 sec for reward
  cd.textContent = `‚è≥ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶≤‡¶õ‡ßá... ${left}s`;
  const t = setInterval(()=>{
    left--;
    if(left>0){ cd.textContent = `‚è≥ ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶≤‡¶õ‡ßá... ${left}s`; return; }
    clearInterval(t);
    // Give reward
    u.balance = +(u.balance + REWARD_PER_AD).toFixed(2);
    u.adsToday = (u.adsToday||0)+1;
    saveState();
    renderHome();
    bomb();
    cd.textContent = `‚úÖ ‡¶è‡¶° ‡¶∂‡ßá‡¶∑! +${REWARD_PER_AD} ‡ß≥ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá`;
    showToast(`‚úÖ ${REWARD_PER_AD} ‡ß≥ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶≤‡ßã`);
    btn.disabled=false; btn.style.opacity='1';
    adRunning=false;
  },1000);
}

/* ====== Withdraw ====== */
async function submitWithdraw(){
  const joined = await enforceJoinGate(); if(!joined) return;
  const u=currentUser(); if(!u){ showToast('üîê ‡¶Ü‡¶ó‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®'); return; }

  const method = document.getElementById('wd-method').value;
  const number = (document.getElementById('wd-number').value||'').trim();
  const amount = parseFloat(document.getElementById('wd-amount').value);

  let min=10; if(method==='nagad') min=50; if(method==='recharge') min=20;

  if(!number || isNaN(amount)){ alert('‚ö†Ô∏è ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶ì ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®'); return; }
  if(amount < min){ alert(`‚ö†Ô∏è ${method} ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ${min} ‡ß≥ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞`); return; }
  if(amount > u.balance){ alert('‚ö†Ô∏è ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á'); return; }

  // deduct and create request
  u.balance = +(u.balance - amount).toFixed(2);
  const req = {
    id:'W'+Date.now().toString(36)+Math.floor(Math.random()*999),
    userId:u.id,
    username:u.username,
    method, number, amount,
    status:'Pending',
    ts:new Date().toISOString()
  };
  state.withdraws.push(req);
  saveState();
  renderHome();
  renderHistory();
  showToast('üì© ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶≤‡ßã (Pending)');

  // Notify Admin + also ping user (if bot started)
  const text = `üì© ‡¶®‡¶§‡ßÅ‡¶® ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü\nID: ${req.id}\nüë§ User: ${u.username} (${u.id})\nüí≥ Method: ${method}\nüì± Number: ${number}\nüí∞ Amount: ‡ß≥${fmt(amount)}`;
  sendTelegram(ADMIN_CHAT_ID, text);
  sendTelegram(u.id, `‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∞‡¶ø‡¶∏‡¶ø‡¶≠‡¶°: ${req.id}\n‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏: Pending`);
}

/* ====== History Render ====== */
function renderHistory(){
  const ul=document.getElementById('history-list'); ul.innerHTML='';
  const mine = state.withdraws.filter(r=>r.userId===state.currentUserId).slice().reverse();
  if(mine.length===0){ ul.innerHTML='<li class="opacity-80 text-sm">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ ‡¶®‡ßá‡¶á‡•§</li>'; return; }
  mine.forEach(r=>{
    const li=document.createElement('li'); li.className='p-3 bg-white/5 rounded';
    li.innerHTML = `<div class="flex justify-between">
      <div><b>${r.id}</b><div class="text-xs opacity-80">${r.method} ‚Üí ${r.number}</div></div>
      <div class="text-right"><div>‡ß≥ ${fmt(r.amount)}</div><div class="text-xs ${r.status==='Pending'?'text-yellow-300':r.status==='Approved'?'text-emerald-300':'text-rose-300'}">${r.status}</div></div>
    </div>
    <div class="text-xs opacity-70 mt-1">${new Date(r.ts).toLocaleString()}</div>`;
    ul.appendChild(li);
  });
}

/* ====== Admin ====== */
function adminLogin(){
  const p=document.getElementById('admin-pass').value;
  if(p===ADMIN_PASSWORD){
    document.getElementById('admin-login').classList.add('hidden');
    document.getElementById('admin-area').classList.remove('hidden');
    renderAdmin();
  }else{
    alert('‚ùå ‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°');
  }
}
function renderAdmin(){
  const tbody=document.getElementById('admin-users-tbody');
  const wtbody=document.getElementById('admin-wd-tbody');
  if(!tbody||!wtbody) return;

  // Summary
  const users = Object.values(state.users);
  document.getElementById('admin-user-count').textContent = users.length;
  const totalAds = users.reduce((a,u)=>a+(u.adsToday||0),0);
  document.getElementById('admin-total-ads').textContent = totalAds;
  const totalBal = users.reduce((a,u)=>a+(u.balance||0),0);
  document.getElementById('admin-total-balance').textContent = fmt(totalBal);

  // Users table
  tbody.innerHTML='';
  users.forEach(u=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${u.id}</td><td>${u.username||'-'}</td><td>‡ß≥ ${fmt(u.balance||0)}</td><td>${u.adsToday||0}</td>`;
    tbody.appendChild(tr);
  });

  // Pending withdraws
  wtbody.innerHTML='';
  state.withdraws.filter(r=>r.status==='Pending').slice().reverse().forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td>
      <td>${r.username} (${r.userId})</td>
      <td>${r.method}</td>
      <td>‡ß≥ ${fmt(r.amount)}</td>
      <td>${r.number}</td>
      <td class="space-x-1">
        <button class="px-2 py-1 bg-emerald-600 rounded" onclick="adminApprove('${r.id}')">Approve</button>
        <button class="px-2 py-1 bg-rose-600 rounded" onclick="adminReject('${r.id}')">Reject</button>
      </td>`;
    wtbody.appendChild(tr);
  });
}
function adminApprove(id){
  const r = state.withdraws.find(x=>x.id===id); if(!r) return;
  r.status='Approved'; saveState(); renderHistory(); renderAdmin();
  sendTelegram(ADMIN_CHAT_ID, `‚úÖ APPROVED: ${r.id} ‚Ä¢ ${r.username} (${r.userId}) ‚Ä¢ ‡ß≥${fmt(r.amount)} ‚Ä¢ ${r.method}/${r.number}`);
  sendTelegram(r.userId, `‚úÖ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ APPROVED ‡¶π‡ßü‡ßá‡¶õ‡ßá: ${r.id}`);
  showToast('‚úÖ Approved');
}
function adminReject(id){
  const r = state.withdraws.find(x=>x.id===id); if(!r) return;
  r.status='Rejected'; // ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶´‡ßá‡¶∞‡¶§ ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®
  saveState(); renderHistory(); renderAdmin();
  sendTelegram(ADMIN_CHAT_ID, `‚ùå REJECTED: ${r.id} ‚Ä¢ ${r.username} (${r.userId}) ‚Ä¢ ‡ß≥${fmt(r.amount)} ‚Ä¢ ${r.method}/${r.number}`);
  sendTelegram(r.userId, `‚ùå ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ REJECTED ‡¶π‡ßü‡ßá‡¶õ‡ßá: ${r.id}`);
  showToast('‚ùå Rejected');
}

/* ====== Telegram Send ====== */
function sendTelegram(chatId, text){
  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chat_id: String(chatId), text})
  }).catch(()=>{});
}

/* ====== Refer ====== */
function copyRefer(){
  const link = document.getElementById('ref-link').value;
  navigator.clipboard.writeText(link).then(()=>showToast('‚úÖ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá'));
}

/* ====== Boot ====== */
loadState();
// ‡¶Ø‡¶¶‡¶ø ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶•‡¶æ‡¶ï‡ßá (state.currentUserId), ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶á ‡¶ì join ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶ø
(asyn