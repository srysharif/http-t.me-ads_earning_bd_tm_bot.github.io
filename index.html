<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BD TM MINI BOT</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Monetag SDK -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>
</head>
<body class="bg-gradient-to-r from-blue-900 to-purple-900 min-h-screen text-white flex flex-col items-center">

  <!-- Header -->
  <header class="w-full p-4 text-center bg-black bg-opacity-40 shadow-lg">
    <h1 class="text-3xl font-bold">ğŸ’ BD TM MINI BOT</h1>
    <p class="text-sm opacity-80">Earn by Watching Ads & Referring Friends</p>
  </header>

  <!-- Join Channel -->
  <div class="mt-6">
    <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank"
       class="px-6 py-3 bg-green-500 hover:bg-green-600 rounded-2xl shadow-lg font-semibold">
       ğŸ“¢ Join Channel
    </a>
  </div>

  <!-- Buttons Section -->
  <div class="grid grid-cols-2 gap-6 mt-10 w-11/12 max-w-lg">

    <!-- View Ad -->
    <button onclick="showAd()" class="p-6 bg-blue-600 hover:bg-blue-700 rounded-2xl shadow-lg">
      â–¶ View Ad
    </button>

    <!-- Withdraw -->
    <button onclick="openWithdraw()" class="p-6 bg-yellow-500 hover:bg-yellow-600 text-black font-bold rounded-2xl shadow-lg">
      ğŸ’³ Withdraw
    </button>

    <!-- History -->
    <button onclick="openHistory()" class="p-6 bg-purple-600 hover:bg-purple-700 rounded-2xl shadow-lg">
      ğŸ“œ History
    </button>

    <!-- Refer -->
    <button onclick="copyRefer()" class="p-6 bg-pink-600 hover:bg-pink-700 rounded-2xl shadow-lg">
      ğŸ Refer
    </button>
  </div>

  <!-- Balance -->
  <div id="balanceBox" class="mt-10 text-lg font-semibold">
    Balance: <span id="balance">0.00</span> à§³
  </div>

  <!-- Ad Limit -->
  <div id="adsInfo" class="mt-4 text-sm opacity-90">
    Todayâ€™s Ads: <span id="adsCount">0</span> / 100
  </div>

  <!-- Countdown Timer -->
  <div id="countdownBox" class="mt-4 text-xl font-bold hidden">
    â³ Please wait <span id="countdown">17</span> seconds...
  </div>

  <!-- Withdraw Modal -->
  <div id="withdrawModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center">
    <div class="bg-white text-black rounded-2xl p-6 w-80">
      <h2 class="text-xl font-bold mb-2">Withdraw Request</h2>
      <p class="text-xs text-gray-600 mb-4">âš  Minimum Withdraw: 10à§³ (Bkash only)</p>
      
      <input id="bkashNumber" type="text" placeholder="Bkash Number"
             class="w-full p-2 border rounded mb-3" />
      <input id="amount" type="number" placeholder="Amount (min 10)"
             class="w-full p-2 border rounded mb-3" />
      <div class="flex justify-between">
        <button onclick="submitWithdraw()" class="px-4 py-2 bg-green-600 text-white rounded-lg">Submit</button>
        <button onclick="closeWithdraw()" class="px-4 py-2 bg-gray-500 text-white rounded-lg">Cancel</button>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div id="historyModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center">
    <div class="bg-white text-black rounded-2xl p-6 w-[650px] max-h-[80vh] overflow-y-auto">
      <h2 class="text-xl font-bold mb-4">Withdraw History</h2>

      <!-- Summary -->
      <div class="mb-3 text-sm font-semibold">
        Total Withdrawn: à§³<span id="totalWithdraw">0.00</span>
      </div>

      <table class="w-full text-sm border">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 border">Amount</th>
            <th class="p-2 border">Number</th>
            <th class="p-2 border">Status</th>
            <th class="p-2 border">Date</th>
            <th class="p-2 border">Action</th>
          </tr>
        </thead>
        <tbody id="historyList" class="text-center"></tbody>
      </table>

      <div class="flex justify-center mt-4">
        <button onclick="closeHistory()" class="px-4 py-2 bg-gray-500 text-white rounded-lg">Close</button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    let balance = parseFloat(localStorage.getItem("balance")) || 0;
    let adsWatched = parseInt(localStorage.getItem("adsWatched")) || 0;
    const dailyLimit = 100;

    // --- Date reset system ---
    const today = new Date().toDateString();
    const savedDate = localStorage.getItem("adsDate");
    if (savedDate !== today) {
      adsWatched = 0;
      localStorage.setItem("adsDate", today);
      localStorage.setItem("adsWatched", adsWatched);
    }

    // --- Withdraw history load ---
    let history = JSON.parse(localStorage.getItem("history")) || [];

    // UI à¦ªà§à¦°à¦¾à¦¥à¦®à¦¿à¦• à¦®à¦¾à¦¨ à¦¸à§‡à¦Ÿ
    document.getElementById("balance").innerText = balance.toFixed(2);
    document.getElementById("adsCount").innerText = adsWatched;
    renderHistory();

    // --- Ad Watching System ---
    function showAd() {
      if (adsWatched >= dailyLimit) {
        alert("âš  Todayâ€™s limit reached (100 ads). Try again tomorrow.");
        return;
      }

      if (typeof show_9842278 === "function") {
        show_9842278(); 
      } else {
        console.log("âš  Monetag Ad not loaded, running simulation...");
      }

      let counter = 17;
      document.getElementById("countdownBox").classList.remove("hidden");
      document.getElementById("countdown").innerText = counter;

      const interval = setInterval(() => {
        counter--;
        document.getElementById("countdown").innerText = counter;

        if (counter < 0) {
          clearInterval(interval);
          document.getElementById("countdownBox").classList.add("hidden");

          balance += 0.2;
          adsWatched++;

          localStorage.setItem("balance", balance);
          localStorage.setItem("adsWatched", adsWatched);

          document.getElementById("balance").innerText = balance.toFixed(2);
          document.getElementById("adsCount").innerText = adsWatched;

          alert("âœ… Ad watched! +0.20 à§³ added.");
        }
      }, 1000);
    }

    // --- Withdraw System ---
    function openWithdraw() {
      document.getElementById("withdrawModal").classList.remove("hidden");
    }
    function closeWithdraw() {
      document.getElementById("withdrawModal").classList.add("hidden");
    }
    function submitWithdraw() {
      const number = document.getElementById("bkashNumber").value;
      const amount = parseFloat(document.getElementById("amount").value);
      if (!number || amount < 10 || amount > balance) {
        alert("âš  Invalid request. Min 10 & within balance.");
        return;
      }

      balance -= amount;
      document.getElementById("balance").innerText = balance.toFixed(2);

      const entry = { 
        id: Date.now(), 
        amount, 
        number, 
        status: "Pending",
        date: new Date().toLocaleString()
      };
      history.push(entry);
      localStorage.setItem("history", JSON.stringify(history));
      localStorage.setItem("balance", balance);

      renderHistory();
      closeWithdraw();
    }

    // --- History System ---
    function renderHistory() {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      let total = 0;

      history.forEach(h => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td class="p-2 border">à§³${h.amount}</td>
          <td class="p-2 border">${h.number}</td>
          <td class="p-2 border font-semibold ${h.status==="Pending"?"text-orange-500":"text-green-600"}">${h.status}</td>
          <td class="p-2 border">${h.date}</td>
          <td class="p-2 border">
            ${h.status==="Pending" ? `<button onclick="updateStatus(${h.id})" class="px-2 py-1 bg-green-600 text-white rounded text-xs">Mark Paid</button>` : "-"}
          </td>
        `;
        list.appendChild(row);

        if (h.status === "Paid") {
          total += h.amount;
        }
      });

      document.getElementById("totalWithdraw").innerText = total.toFixed(2);
    }

    function updateStatus(id) {
      history = history.map(h => h.id === id ? { ...h, status: "Paid" } : h);
      localStorage.setItem("history", JSON.stringify(history));
      renderHistory();
    }

    function openHistory() {
      document.getElementById("historyModal").classList.remove("hidden");
    }
    function closeHistory() {
      document.getElementById("historyModal").classList.add("hidden");
    }

    // --- Refer System ---
    function copyRefer() {
      const referLink = "https://t.me/BD_TM_MINI_BOT";
      navigator.clipboard.writeText(referLink).then(() => {
        alert("âœ… Refer link copied: " + referLink);
      });
    }
  </script>
</body>
          </html>
