<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BD TM MINI BOT</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Monetag -->
  <script src="//libtl.com/sdk.js" data-zone="9842278" data-sdk="show_9842278"></script>

  <style>
    body { font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    .glass { background: rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.08); backdrop-filter: blur(12px); border-radius:16px; }
    .lighting { animation: glow 8s infinite alternate ease-in-out; }
    @keyframes glow {
      0% { color:#60a5fa; text-shadow:0 0 10px #60a5fa; }
      25% { color:#a78bfa; text-shadow:0 0 12px #a78bfa; }
      50% { color:#34d399; text-shadow:0 0 12px #34d399; }
      75% { color:#f59e0b; text-shadow:0 0 14px #f59e0b; }
      100%{ color:#fb7185; text-shadow:0 0 16px #fb7185; }
    }
    .bottom { position:fixed; left:0; right:0; bottom:0; padding:10px; background:rgba(0,0,0,0.25); backdrop-filter:blur(8px); }
    .navbtn { width:100%; padding:10px 8px; border-radius:14px; font-weight:700; }
    .emoji { position:fixed; font-size:2rem; opacity:.12; user-select:none; pointer-events:none; animation:float 24s linear infinite; }
    .emoji.e2{ left:25%; animation-duration:28s; }
    .emoji.e3{ left:55%; animation-duration:20s; }
    .emoji.e4{ left:80%; animation-duration:26s; }
    @keyframes float { 0%{ transform:translateY(110vh) rotate(0) } 100%{ transform:translateY(-20vh) rotate(360deg) } }
    .bomb { position:fixed; left:50%; top:45%; transform:translate(-50%,-50%); font-size:3rem; z-index:40; animation:bomb 1s ease forwards; }
    @keyframes bomb { 0%{ opacity:0; transform:translate(-50%,-50%) scale(.8) } 50%{ opacity:1; transform:translate(-50%,-55%) scale(1.6) } 100%{ opacity:0; transform:translate(-50%,-80%) scale(2.4) } }
    .tab { display:none; opacity:0; transform:translateY(8px); transition:all .3s; }
    .tab.show { display:block; opacity:1; transform:translateY(0); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#091535] via-[#0b1120] to-[#2b0b3a] text-white pb-28">

  <div class="emoji">üòç</div><div class="emoji e2">ü§ñ</div><div class="emoji e3">üòÇ</div><div class="emoji e4">üòé</div>

  <header class="p-5 text-center">
    <div class="glass p-4 max-w-xl mx-auto">
      <h1 class="text-3xl font-extrabold lighting">üíé BD TM MINI BOT</h1>
      <p class="opacity-80 text-sm">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶® ‚Ä¢ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶®</p>
    </div>
  </header>

  <main class="px-4 max-w-xl mx-auto space-y-4">
    <!-- Login/Register -->
    <section id="tab-login" class="tab show">
      <div class="glass p-5">
        <h2 class="text-xl font-bold lighting">üîê ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
        <p class="text-sm opacity-80 mt-1">‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ Username ‡¶ì Numeric ID ‡¶¶‡¶ø‡¶®‡•§ (ID ‡¶™‡ßá‡¶§‡ßá @userinfobot)</p>
        <div class="mt-4 space-y-3">
          <input id="username" class="w-full p-3 rounded text-black" placeholder="Username (without @)" />
          <input id="tgId" class="w-full p-3 rounded text-black" placeholder="Numeric Telegram ID" />
          <button onclick="register()" class="w-full py-3 bg-emerald-600 rounded-lg font-semibold">üöÄ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank" class="block text-center underline text-sm mt-1">üì¢ ‡¶Ü‡¶ó‡ßá ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        </div>
      </div>
    </section>

    <!-- Home -->
    <section id="tab-home" class="tab">
      <div class="glass p-5 text-center">
        <div class="lighting">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</div>
        <div class="text-4xl font-extrabold mt-1"><span id="ui-balance">0.00</span> ‡ß≥</div>
        <div class="mt-2 text-sm opacity-80">‡¶Ü‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ: <span id="ui-ads">0</span> / 100</div>
        <div class="mt-3 flex justify-center gap-2">
          <a href="https://t.me/ADS_EARNING_BD_TM_CHANNEL" target="_blank" class="px-4 py-2 bg-green-600 rounded-xl font-semibold">üì¢ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶®</a>
          <button onclick="openTab('ads')" class="px-4 py-2 bg-blue-600 rounded-xl font-semibold">‚ñ∂ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>
        <div id="joinStatus" class="text-xs opacity-70 mt-2"></div>
      </div>
    </section>

    <!-- Ads -->
    <section id="tab-ads" class="tab">
      <div class="glass p-5 text-center">
        <div class="flex justify-between">
          <div class="font-semibold lighting">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶®</div>
          <div class="text-sm opacity-80">‡ßß‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° + ‡ßß‡ß≠ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü</div>
        </div>
        <div class="mt-4">
          <button id="btn-start-ad" onclick="startAd()" class="w-full py-3 bg-blue-600 rounded-xl font-bold">‚ñ∂ ‡¶è‡¶ñ‡¶®‡¶á ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        </div>
        <div id="adTimer" class="mt-3 text-sm opacity-80"></div>
      </div>
    </section>

    <!-- Withdraw -->
    <section id="tab-withdraw" class="tab">
      <div class="glass p-5">
        <h2 class="text-xl font-bold lighting">üí≥ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h2>
        <div class="text-xs opacity-80 mb-2">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡ßß‡ß¶‡ß≥ ‚Ä¢ ‡¶®‡¶ó‡¶¶ ‡ß´‡ß¶‡ß≥ ‚Ä¢ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú ‡ß®‡ß¶‡ß≥</div>
        <div class="space-y-3">
          <select id="method" class="w-full p-3 rounded text-black">
            <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
            <option value="nagad">‡¶®‡¶ó‡¶¶</option>
            <option value="recharge">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶∞‡¶ø‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</option>
          </select>
          <input id="number" class="w-full p-3 rounded text-black" placeholder="‡¶®‡¶Æ‡ßç‡¶¨‡¶∞" />
          <input id="amount" type="number" class="w-full p-3 rounded text-black" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" />
          <button onclick="withdraw()" class="w-full py-3 bg-emerald-600 rounded-xl font-semibold">üì© ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
        </div>
      </div>
    </section>

    <!-- History -->
    <section id="tab-history" class="tab">
      <div class="glass p-5">
        <h2 class="text-xl font-bold lighting">üìú ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</h2>
        <ul id="history" class="mt-3 space-y-2 text-sm"></ul>
      </div>
    </section>

    <!-- Refer -->
    <section id="tab-refer" class="tab">
      <div class="glass p-5 text-center">
        <div class="font-semibold lighting">üéÅ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</div>
        <div class="mt-3 flex justify-center gap-2">
          <input id="ref" class="p-2 rounded text-black w-2/3" readonly value="https://t.me/BD_TM_MINI_BOT" />
          <button onclick="copyRef()" class="px-3 py-2 bg-pink-600 rounded-lg">‡¶ï‡¶™‡¶ø</button>
        </div>
      </div>
    </section>
  </main>

  <nav class="bottom">
    <div class="max-w-xl mx-auto grid grid-cols-5 gap-2">
      <button class="navbtn bg-white/10" onclick="openTab('home')">üè† ‡¶π‡ßã‡¶Æ</button>
      <button class="navbtn bg-white/10" onclick="openTab('ads')">‚ñ∂ ‡¶è‡¶°</button>
      <button class="navbtn bg-white/10" onclick="openTab('withdraw')">üí≥ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</button>
      <button class="navbtn bg-white/10" onclick="openTab('history')">üìú ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø</button>
      <a class="navbtn bg-white/10 text-center" href="/admin.html">‚öô ‡¶è‡¶°‡¶Æ‡¶ø‡¶®</a>
    </div>
  </nav>

  <div id="bomb"></div>

<script>
const API = location.origin + "/api";
let SESSION = { username:null, tgId:null, joined:false, user:null };

function openTab(key){
  document.querySelectorAll(".tab").forEach(x=>{ x.classList.remove("show"); x.style.display="none"; });
  const el = document.getElementById("tab-"+key);
  if(el){ el.style.display="block"; setTimeout(()=>el.classList.add("show"),10); }
}

function bomb(){
  const b = document.getElementById("bomb");
  const el = document.createElement("div");
  el.className = "bomb";
  el.textContent = "üí£üí•";
  b.appendChild(el);
  setTimeout(()=>el.remove(),1000);
}

function fmt(n){ return Number(n||0).toFixed(2); }

async function post(url, data){
  const r = await fetch(url,{ method:"POST", headers:{ "Content-Type":"application/json" }, body:JSON.stringify(data||{}) });
  return await r.json();
}

async function register(){
  const username = document.getElementById("username").value.trim().replace(/^@/,"");
  const tgId = document.getElementById("tgId").value.trim();
  if(!username || !tgId) return alert("Username ‡¶ì Numeric Telegram ID ‡¶¶‡¶ø‡¶®");

  const r = await post(API+"/register", { username, tgId });
  if(!r.ok) return alert(r.error||"‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•");

  SESSION.username = username;
  SESSION.tgId = tgId;
  SESSION.joined = r.joined;
  SESSION.user = r.user;

  if(!r.joined){
    document.getElementById("joinStatus").innerHTML = "‚ùå ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø‡•§ ‡¶Ü‡¶ó‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
  }else{
    document.getElementById("joinStatus").innerHTML = "‚úÖ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§";
  }

  document.getElementById("ui-balance").innerText = fmt(r.user.balance);
  document.getElementById("ui-ads").innerText = r.user.adsCountToday;
  openTab("home");
}

async function startAd(){
  if(!SESSION.tgId) return openTab("login");

  const check = await post(API+"/check-join", { username:SESSION.username, tgId:SESSION.tgId });
  if(!check.ok || !check.joined){
    alert("‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ï‡¶æ‡¶ú ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§");
    return;
  }

  const s = await post(API+"/ad/start", { username:SESSION.username, tgId:SESSION.tgId });
  if(!s.ok) return alert(s.error||"‡¶è‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡ßü‡¶®‡¶ø");

  // Monetag popup (‡ßß‡ß´‡¶∏‡ßá‡¶ï)
  if(typeof show_9842278 === "function"){ try{ show_9842278(); }catch(e){} }

  const adTimer = document.getElementById("adTimer");
  let left = 17;
  adTimer.innerText = `‚è≥ ‡¶ö‡¶≤‡¶õ‡ßá... ${left}s`;
  const t = setInterval(()=>{
    left--;
    adTimer.innerText = `‚è≥ ‡¶ö‡¶≤‡¶õ‡ßá... ${left}s`;
    if(left<=0){
      clearInterval(t);
      adTimer.innerText = "‚úÖ ‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡¶ø...";
      completeAd(s.ticketId);
    }
  },1000);
}

async function completeAd(ticketId){
  const c = await post(API+"/ad/complete", { username:SESSION.username, tgId:SESSION.tgId, ticketId });
  if(!c.ok) return alert(c.error||"‡¶ï‡ßç‡¶∞‡ßá‡¶°‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•");
  document.getElementById("ui-balance").innerText = fmt(c.balance);
  document.getElementById("ui-ads").innerText = c.adsCountToday;
  bomb();
  alert("‚úÖ +0.20 ‡ß≥ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
}

async function withdraw(){
  if(!SESSION.tgId) return openTab("login");
  const method = document.getElementById("method").value;
  const number = document.getElementById("number").value.trim();
  const amount = parseFloat(document.getElementById("amount").value);

  if(!number || !amount) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
  const w = await post(API+"/withdraw", { username:SESSION.username, tgId:SESSION.tgId, method, number, amount });
  if(!w.ok) return alert(w.error||"‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•");

  document.getElementById("ui-balance").innerText = fmt(w.balance);
  alert("üì© ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá (Pending)‡•§");
  loadHistory();
}

async function loadHistory(){
  if(!SESSION.tgId) return;
  const h = await post(API+"/history", { username:SESSION.username, tgId:SESSION.tgId });
  if(!h.ok) return;
  const ul = document.getElementById("history");
  ul.innerHTML = "";
  h.history.forEach(x=>{
    const li = document.createElement("li");
    li.className = "p-3 bg-white/5 rounded";
    li.innerHTML = `<div class="flex justify-between">
      <div><b>${x.id}</b><div class="text-xs opacity-70">${x.method} ‚Üí ${x.number}</div></div>
      <div class="text-right"><div>‡ß≥ ${fmt(x.amount)}</div><div class="text-xs opacity-70">${x.status}</div></div>
    </div>
    <div class="text-xs opacity-70 mt-1">${new Date(x.createdAt).toLocaleString()}</div>`;
    ul.appendChild(li);
  });
}

</script>
</body>
</html>